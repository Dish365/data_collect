<TopBar>:
    size_hint_y: None
    height: dp(56)
    md_bg_color: app.theme_cls.primary_color
    orientation: 'horizontal'
    padding: dp(8)
    spacing: dp(8)

    # Main navigation section
    MDBoxLayout:
        orientation: 'horizontal'
        adaptive_size: True
        spacing: dp(4)
        pos_hint: {"center_y": 0.5}

        MDIconButton:
            icon: "view-dashboard"
            theme_icon_color: "Custom"
            icon_color: 1, 1, 1, 1
            pos_hint: {"center_y": 0.5}
            on_release: root.navigate_to_screen('dashboard')
            tooltip_text: "Dashboard"

        MDIconButton:
            icon: "folder-multiple"
            theme_icon_color: "Custom"
            icon_color: 1, 1, 1, 1
            pos_hint: {"center_y": 0.5}
            on_release: root.navigate_to_screen('projects')
            tooltip_text: "Projects"

        MDIconButton:
            icon: "chart-line"
            theme_icon_color: "Custom"
            icon_color: 1, 1, 1, 1
            pos_hint: {"center_y": 0.5}
            on_release: root.navigate_to_screen('analytics')
            tooltip_text: "Analytics"

        MDIconButton:
            icon: "clipboard-text"
            theme_icon_color: "Custom"
            icon_color: 1, 1, 1, 1
            pos_hint: {"center_y": 0.5}
            on_release: root.navigate_to_screen('data_collection')
            tooltip_text: "Data Collection"

        MDIconButton:
            icon: "format-list-bulleted"
            theme_icon_color: "Custom"
            icon_color: 1, 1, 1, 1
            pos_hint: {"center_y": 0.5}
            on_release: root.navigate_to_screen('responses')
            tooltip_text: "Responses"

    MDLabel:
        id: top_title
        text: "Dashboard"
        font_style: "H6"
        theme_text_color: "Custom"
        text_color: 1, 1, 1, 1
        size_hint_x: 1
        pos_hint: {"center_y": 0.5}

    MDBoxLayout:
        orientation: 'horizontal'
        adaptive_size: True
        pos_hint: {"center_y": 0.5}
        spacing: dp(8)

        # Notification button with badge
        RelativeLayout:
            size_hint: None, None
            size: dp(48), dp(48)
            pos_hint: {"center_y": 0.5}

            MDIconButton:
                id: notification_button
                icon: "bell"
                theme_icon_color: "Custom"
                icon_color: 1, 1, 1, 1
                pos_hint: {"center_x": 0.5, "center_y": 0.5}
                on_release: root.show_notifications()
                tooltip_text: "Notifications"

            # Notification badge
            MDLabel:
                id: notification_badge
                text: "0"
                font_style: "Caption"
                theme_text_color: "Custom"
                text_color: 1, 1, 1, 1
                size_hint: None, None
                size: dp(18), dp(18)
                pos_hint: {"center_x": 0.75, "center_y": 0.75}
                md_bg_color: 1, 0, 0, 1  # Red background
                radius: [dp(9)]
                halign: "center"
                valign: "center"
                opacity: 0  # Initially hidden
                canvas.before:
                    Color:
                        rgba: self.md_bg_color
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: self.radius

        MDIconButton:
            icon: "account-circle-outline"
            theme_text_color: "Custom"
            icon_color: 1, 1, 1, 1
            pos_hint: {"center_y": 0.5}

        MDLabel:
            id: user_name
            text: app.user_display_name
            font_style: "Subtitle1"
            theme_text_color: "Custom"
            text_color: 1, 1, 1, 1
            adaptive_size: True
            pos_hint: {"center_y": 0.5}

        MDIconButton:
            icon: "logout"
            theme_icon_color: "Custom"
            icon_color: 1, 1, 1, 1
            pos_hint: {"center_y": 0.5}
            on_release: root.logout()
