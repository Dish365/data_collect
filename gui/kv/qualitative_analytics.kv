#:kivy 2.0
#:import MDCard kivymd.uix.card.MDCard
#:import MDScrollView kivymd.uix.scrollview.MDScrollView
#:import MDLabel kivymd.uix.label.MDLabel
#:import MDButton kivymd.uix.button.MDButton
#:import MDIconButton kivymd.uix.button.MDIconButton
#:import MDBoxLayout kivymd.uix.boxlayout.MDBoxLayout
#:import MDTextField kivymd.uix.textfield.MDTextField
#:import MDCheckbox kivymd.uix.selectioncontrol.MDCheckbox
#:import MDDropdownMenu kivymd.uix.menu.MDDropdownMenu
#:import MDCircularProgressIndicator kivymd.uix.progressindicator.MDCircularProgressIndicator
#:import MDDialog kivymd.uix.dialog.MDDialog
#:import MDDialogHeadlineText kivymd.uix.dialog.MDDialogHeadlineText
#:import MDDialogSupportingText kivymd.uix.dialog.MDDialogSupportingText
#:import MDDialogButtonContainer kivymd.uix.dialog.MDDialogButtonContainer
#:import GridLayout kivy.uix.gridlayout.GridLayout
#:import dp kivy.metrics.dp

# Main Qualitative Analytics Screen Layout
<QualitativeAnalyticsScreen>:
    name: 'qualitative_analytics'
    
    MDScrollView:
        MDBoxLayout:
            id: main_content
            orientation: 'vertical'
            spacing: dp(16)
            padding: [dp(24), dp(8), dp(24), dp(20)]
            size_hint_y: None
            height: self.minimum_height
            
            # Top Navigation Bar
            TopBar:
                id: top_bar
                size_hint_y: None
                height: dp(56)
            
            # Project Selection Card
            QualitativeProjectCard:
                id: project_selection_card
            
            # Analysis Type Selection Card
            QualitativeAnalysisTypeCard:
                id: analysis_type_card
            
            # Text Field Selection Card
            QualitativeTextFieldCard:
                id: text_field_card
            
            # Analysis Controls Card
            QualitativeControlsCard:
                id: analysis_controls_card
            
            # Text Analysis Overview Card
            QualitativeOverviewCard:
                id: overview_card
            
            # Analysis Results Card
            QualitativeResultsCard:
                id: results_card
            
            # Action Buttons Card
            QualitativeActionsCard:
                id: actions_card

# Project Selection Card Component
<QualitativeProjectCard@MDCard>:
    orientation: 'horizontal'
    size_hint_y: None
    height: dp(64)
    elevation: 2
    md_bg_color: 0.98, 0.99, 1.0, 1
    radius: [12, 12, 12, 12]
    padding: [dp(20), dp(12), dp(20), dp(12)]
    spacing: dp(16)
    
    # Title Section
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(12)
        size_hint_x: 0.4
        
        MDIconButton:
            icon: "text-box"
            theme_icon_color: "Custom"
            icon_color: 0.6, 0.2, 0.8, 1
            size_hint_x: None
            width: dp(36)
            icon_size: "20dp"
            disabled: True
        
        MDLabel:
            text: "Qualitative Analytics"
            theme_text_color: "Primary"
            font_style: "Headline"
            role: "small"
            bold: True
            halign: "left"
            valign: "center"
    
    # Project Selector
    MDButton:
        id: project_selector
        text: "Select Project"
        style: "filled"
        size_hint_x: 0.4
        theme_bg_color: "Custom"
        md_bg_color: 0.6, 0.2, 0.8, 1

# NEW COMPREHENSIVE RESULT COMPONENTS

# Text Analysis Results
<QualitativeTextResults@MDBoxLayout>:
    orientation: 'vertical'
    spacing: dp(8)
    
    MDLabel:
        text: "Text Analysis Complete"
        theme_text_color: "Primary"
        font_style: "Title"
        role: "large"
        size_hint_y: None
        height: dp(32)
    
    MDLabel:
        text: "Basic text statistics and patterns have been analyzed"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        size_hint_y: None
        height: dp(24)

# Sentiment Analysis Results
<QualitativeSentimentResults@MDBoxLayout>:
    orientation: 'vertical'
    spacing: dp(8)
    
    MDLabel:
        text: "Sentiment Analysis Results"
        theme_text_color: "Primary"
        font_style: "Title"
        role: "large"
        size_hint_y: None
        height: dp(32)
    
    GridLayout:
        cols: 3
        spacing: dp(8)
        size_hint_y: None
        height: dp(120)
        
        MDCard:
            orientation: 'vertical'
            padding: dp(8)
            md_bg_color: 0.2, 0.8, 0.2, 0.2
            elevation: 1
            radius: [8, 8, 8, 8]
            
            MDLabel:
                text: "Positive"
                theme_text_color: "Custom"
                text_color: 0.2, 0.8, 0.2, 1
                font_style: "Body"
                role: "small"
                halign: "center"
        
        MDCard:
            orientation: 'vertical'
            padding: dp(8)
            md_bg_color: 0.5, 0.5, 0.5, 0.2
            elevation: 1
            radius: [8, 8, 8, 8]
            
            MDLabel:
                text: "Neutral"
                theme_text_color: "Custom"
                text_color: 0.5, 0.5, 0.5, 1
                font_style: "Body"
                role: "small"
                halign: "center"
        
        MDCard:
            orientation: 'vertical'
            padding: dp(8)
            md_bg_color: 0.8, 0.2, 0.2, 0.2
            elevation: 1
            radius: [8, 8, 8, 8]
            
            MDLabel:
                text: "Negative"
                theme_text_color: "Custom"
                text_color: 0.8, 0.2, 0.2, 1
                font_style: "Body"
                role: "small"
                halign: "center"

# Theme Analysis Results
<QualitativeThemeResults@MDBoxLayout>:
    orientation: 'vertical'
    spacing: dp(8)
    
    MDLabel:
        text: "Theme Analysis Results"
        theme_text_color: "Primary"
        font_style: "Title"
        role: "large"
        size_hint_y: None
        height: dp(32)
    
    MDLabel:
        text: "Key themes and topics have been identified"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        size_hint_y: None
        height: dp(24)

# Word Frequency Results
<QualitativeWordFrequencyResults@MDBoxLayout>:
    orientation: 'vertical'
    spacing: dp(8)
    
    MDLabel:
        text: "Word Frequency Analysis"
        theme_text_color: "Primary"
        font_style: "Title"
        role: "large"
        size_hint_y: None
        height: dp(32)
    
    MDLabel:
        text: "Most frequent words and patterns identified"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        size_hint_y: None
        height: dp(24)

# Content Analysis Results
<QualitativeContentAnalysisResults@MDBoxLayout>:
    orientation: 'vertical'
    spacing: dp(8)
    
    MDLabel:
        text: "Content Analysis Results"
        theme_text_color: "Primary"
        font_style: "Title"
        role: "large"
        size_hint_y: None
        height: dp(32)
    
    MDLabel:
        text: "Systematic content analysis completed"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        size_hint_y: None
        height: dp(24)

# Qualitative Coding Results
<QualitativeQualitativeCodingResults@MDBoxLayout>:
    orientation: 'vertical'
    spacing: dp(8)
    
    MDLabel:
        text: "Qualitative Coding Results"
        theme_text_color: "Primary"
        font_style: "Title"
        role: "large"
        size_hint_y: None
        height: dp(32)
    
    MDLabel:
        text: "Codes and categories have been identified"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        size_hint_y: None
        height: dp(24)

# Survey Analysis Results
<QualitativeSurveyAnalysisResults@MDBoxLayout>:
    orientation: 'vertical'
    spacing: dp(8)
    
    MDLabel:
        text: "Survey Analysis Results"
        theme_text_color: "Primary"
        font_style: "Title"
        role: "large"
        size_hint_y: None
        height: dp(32)
    
    MDLabel:
        text: "Comprehensive survey response analysis completed"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        size_hint_y: None
        height: dp(24)

# Qualitative Statistics Results
<QualitativeStatisticsResults@MDBoxLayout>:
    orientation: 'vertical'
    spacing: dp(8)
    
    MDLabel:
        text: "Qualitative Statistics"
        theme_text_color: "Primary"
        font_style: "Title"
        role: "large"
        size_hint_y: None
        height: dp(32)
    
    MDLabel:
        text: "Statistical summary of qualitative data"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        size_hint_y: None
        height: dp(24)

# Sentiment Trends Results
<QualitativeSentimentTrendsResults@MDBoxLayout>:
    orientation: 'vertical'
    spacing: dp(8)
    
    MDLabel:
        text: "Sentiment Trends Analysis"
        theme_text_color: "Primary"
        font_style: "Title"
        role: "large"
        size_hint_y: None
        height: dp(32)
    
    MDLabel:
        text: "Sentiment patterns over time and categories"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        size_hint_y: None
        height: dp(24)

# Text Similarity Results
<QualitativeTextSimilarityResults@MDBoxLayout>:
    orientation: 'vertical'
    spacing: dp(8)
    
    MDLabel:
        text: "Text Similarity Analysis"
        theme_text_color: "Primary"
        font_style: "Title"
        role: "large"
        size_hint_y: None
        height: dp(32)
    
    MDLabel:
        text: "Similar text responses and patterns identified"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        size_hint_y: None
        height: dp(24)

# Theme Evolution Results
<QualitativeThemeEvolutionResults@MDBoxLayout>:
    orientation: 'vertical'
    spacing: dp(8)
    
    MDLabel:
        text: "Theme Evolution Analysis"
        theme_text_color: "Primary"
        font_style: "Title"
        role: "large"
        size_hint_y: None
        height: dp(32)
    
    MDLabel:
        text: "How themes change and evolve over time"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        size_hint_y: None
        height: dp(24)

# Quote Extraction Results
<QualitativeQuoteExtractionResults@MDBoxLayout>:
    orientation: 'vertical'
    spacing: dp(8)
    
    MDLabel:
        text: "Quote Extraction Results"
        theme_text_color: "Primary"
        font_style: "Title"
        role: "large"
        size_hint_y: None
        height: dp(32)
    
    MDLabel:
        text: "Representative quotes extracted for themes"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        size_hint_y: None
        height: dp(24)
    
    # Analysis Status
    MDLabel:
        id: analysis_status_label
        text: "Status: Ready"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        size_hint_x: 0.2
        halign: "right"
        valign: "center"

# Analysis Type Selection Card
<QualitativeAnalysisTypeCard@MDCard>:
    orientation: 'vertical'
    size_hint_y: None
    height: dp(140)
    elevation: 2
    md_bg_color: 0.98, 0.99, 1.0, 1
    radius: [12, 12, 12, 12]
    padding: [dp(16), dp(12), dp(16), dp(12)]
    spacing: dp(12)
    
    MDLabel:
        text: "Analysis Type Selection"
        theme_text_color: "Primary"
        font_style: "Headline"
        role: "small"
        bold: True
        size_hint_y: None
        height: dp(32)
    
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(12)
        size_hint_y: None
        height: dp(56)
        
        MDButton:
            id: analysis_type_button
            style: "filled"
            size_hint_x: 0.5
            theme_bg_color: "Custom"
            md_bg_color: 0.6, 0.2, 0.8, 1
            on_release: root.show_analysis_type_menu()
            
            MDButtonText:
                text: "Select Analysis Type"
        
        MDButton:
            id: analysis_method_button
            style: "outlined"
            size_hint_x: 0.5
            theme_outline_color: "Custom"
            line_color: 0.6, 0.2, 0.8, 1
            disabled: False
            on_release: root.show_analysis_method_menu()
            
            MDButtonText:
                text: "Select Method"
    
    MDLabel:
        text: "No analysis type selected"
        theme_text_color: "Secondary"
        font_style: "Label"
        role: "small"
        size_hint_y: None
        height: dp(20)

# Text Field Selection Card
<QualitativeTextFieldCard@MDCard>:
    orientation: 'vertical'
    size_hint_y: None
    height: dp(200)
    elevation: 2
    md_bg_color: 0.99, 0.98, 1.0, 1
    radius: [12, 12, 12, 12]
    padding: [dp(16), dp(12), dp(16), dp(12)]
    spacing: dp(12)
    
    MDLabel:
        text: "Text Field Selection"
        theme_text_color: "Primary"
        font_style: "Headline"
        role: "small"
        bold: True
        size_hint_y: None
        height: dp(32)
    
    MDLabel:
        text: "Select text fields for analysis"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        size_hint_y: None
        height: dp(24)
    
    MDScrollView:
        size_hint_y: None
        height: dp(120)
        
        MDBoxLayout:
            orientation: 'vertical'
            spacing: dp(4)
            size_hint_y: None
            height: self.minimum_height
            
            # Text field checkboxes - populated dynamically
            Label:
                text: "Text fields will appear here after project selection"
                size_hint_y: None
                height: dp(24)

# Analysis Controls Card Component
<QualitativeControlsCard@MDCard>:
    orientation: 'vertical'
    size_hint_y: None
    height: dp(120)
    elevation: 3
    md_bg_color: 0.98, 1.0, 0.98, 1
    radius: [12, 12, 12, 12]
    padding: [dp(16), dp(16), dp(16), dp(16)]
    spacing: dp(12)
    
    # Header
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(12)
        size_hint_y: None
        height: dp(32)
        
        MDIconButton:
            icon: "play-circle"
            theme_icon_color: "Custom"
            icon_color: 0.6, 0.2, 0.8, 1
            disabled: True
            size_hint: None, None
            size: dp(28), dp(28)
        
        MDLabel:
            text: "Analysis Controls"
            theme_text_color: "Primary"
            font_style: "Headline"
            role: "small"
            bold: True
            size_hint_y: None
            height: dp(32)
        
        MDLabel:
            text: "Status: Ready"
            theme_text_color: "Secondary"
            font_style: "Body"
            role: "medium"
            halign: "right"
            size_hint_y: None
            height: dp(32)
    
    # Main action buttons
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(12)
        size_hint_y: None
        height: dp(48)
        
        MDButton:
            text: "Run Analysis"
            style: "filled"
            size_hint_x: 0.4
            theme_bg_color: "Custom"
            md_bg_color: 0.6, 0.2, 0.8, 1
            disabled: False
            on_release: root.run_analysis_by_type(root.selected_analysis_type)
        
        MDButton:
            text: "Clear Results"
            style: "outlined"
            size_hint_x: 0.3
            theme_outline_color: "Custom"
            line_color: 0.8, 0.4, 0.4, 1
            on_release: root.clear_results()
        
        MDButton:
            text: "Export"
            style: "text"
            size_hint_x: 0.3
            theme_text_color: "Custom"
            text_color: 0.6, 0.6, 0.6, 1
            disabled: False
            on_release: root.export_text_results()

# Text Analysis Overview Card Component
<QualitativeOverviewCard@MDCard>:
    orientation: 'vertical'
    size_hint_y: None
    height: dp(200)
    elevation: 2
    md_bg_color: 0.98, 1.0, 0.98, 1
    radius: [12, 12, 12, 12]
    padding: [dp(16), dp(16), dp(16), dp(16)]
    spacing: dp(12)
    opacity: 1
    
    # Header
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(12)
        size_hint_y: None
        height: dp(36)
        
        MDIconButton:
            icon: "text-box-search"
            theme_icon_color: "Custom"
            icon_color: 0.6, 0.2, 0.8, 1
            disabled: True
            size_hint: None, None
            size: dp(32), dp(32)
        
        MDLabel:
            text: "Text Analysis Overview"
            theme_text_color: "Primary"
            font_style: "Headline"
            role: "small"
            bold: True
    
    # Overview content
    MDScrollView:
        do_scroll_x: False
        do_scroll_y: True
        bar_width: dp(8)
        
        MDBoxLayout:
            orientation: 'vertical'
            spacing: dp(8)
            size_hint_y: None
            height: self.minimum_height
            
            # Text fields info
            MDLabel:
                text: f"Text Fields Analyzed: {root.text_fields_analyzed}"
                theme_text_color: "Primary"
                font_style: "Body"
                role: "medium"
                size_hint_y: None
                height: dp(24)
            
            # Total entries info
            MDLabel:
                text: f"Total Text Entries: {root.total_text_entries}"
                theme_text_color: "Secondary"
                font_style: "Body"
                role: "small"
                size_hint_y: None
                height: dp(20)
            
            # Fields list
            MDLabel:
                text: root.analyzed_fields_text
                theme_text_color: "Secondary"
                font_style: "Body"
                role: "small"
                text_size: self.width, None
                size_hint_y: None
                height: dp(60)
            
            # Status
            MDLabel:
                text: root.analysis_status
                theme_text_color: "Primary"
                font_style: "Body"
                role: "medium"
                size_hint_y: None
                height: dp(24)

# Analysis Results Card Component
<QualitativeResultsCard@MDCard>:
    orientation: 'vertical'
    size_hint_y: None
    height: dp(500)
    elevation: 2
    md_bg_color: 1, 1, 1, 1
    radius: [12, 12, 12, 12]
    padding: [dp(16), dp(16), dp(16), dp(16)]
    spacing: dp(12)
    
    # Header
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(12)
        size_hint_y: None
        height: dp(36)
        
        MDIconButton:
            icon: "chart-donut"
            theme_icon_color: "Custom"
            icon_color: 0.8, 0.4, 0.2, 1
            disabled: True
            size_hint: None, None
            size: dp(32), dp(32)
        
        MDLabel:
            text: "Text Analysis Results"
            theme_text_color: "Primary"
            font_style: "Headline"
            role: "small"
            bold: True
        
        # Current analysis type indicator
        MDLabel:
            text: "No analysis completed"
            theme_text_color: "Secondary"
            font_style: "Body"
            role: "medium"
            halign: "right"
            size_hint_x: 0.6
    
    # Results content
    MDScrollView:
        id: results_content
        do_scroll_x: False
        do_scroll_y: True
        bar_width: dp(8)
        
        MDBoxLayout:
            id: results_display
            orientation: 'vertical'
            spacing: dp(12)
            size_hint_y: None
            height: self.minimum_height
            
            # Dynamic results based on current analysis type
            QualitativeEmptyResults:
                opacity: 1 if not root.current_analysis_type else 0
                height: dp(300) if not root.current_analysis_type else 0
            
            # Text Analysis Results
            QualitativeTextResults:
                opacity: 0
                height: 0
            
            # Sentiment Analysis Results  
            QualitativeSentimentResults:
                opacity: 0
                height: 0
            
            # Theme Analysis Results
            QualitativeThemeResults:
                opacity: 0
                height: 0
            
            # Word Frequency Results
            QualitativeWordFrequencyResults:
                opacity: 0
                height: 0
            
            # Content Analysis Results
            QualitativeContentAnalysisResults:
                opacity: 0
                height: 0
            
            # Qualitative Coding Results
            QualitativeQualitativeCodingResults:
                opacity: 0
                height: 0
            
            # Survey Analysis Results
            QualitativeSurveyAnalysisResults:
                opacity: 0
                height: 0
            
            # Qualitative Statistics Results
            QualitativeStatisticsResults:
                opacity: 0
                height: 0
                
            # Sentiment Trends Results
            QualitativeSentimentTrendsResults:
                opacity: 0
                height: 0
            
            # Text Similarity Results
            QualitativeTextSimilarityResults:
                opacity: 0
                height: 0
            
            # Theme Evolution Results
            QualitativeThemeEvolutionResults:
                opacity: 0
                height: 0
            
            # Quote Extraction Results
            QualitativeQuoteExtractionResults:
                opacity: 0
                height: 0

# Action Buttons Card Component
<QualitativeActionsCard@MDCard>:
    orientation: 'horizontal'
    size_hint_y: None
    height: dp(80)
    elevation: 2
    md_bg_color: 0.96, 0.96, 0.96, 1
    radius: [12, 12, 12, 12]
    padding: [dp(16), dp(12), dp(16), dp(12)]
    spacing: dp(12)
    
    # Export actions
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(8)
        size_hint_x: 0.6
        
        MDButton:
            text: "Export JSON"
            style: "filled"
            size_hint_x: 0.33
            theme_bg_color: "Custom"
            md_bg_color: 0.6, 0.2, 0.8, 1
            on_release: root.export_to_json()
        
        MDButton:
            text: "Export CSV"
            style: "outlined"
            size_hint_x: 0.33
            theme_outline_color: "Custom"
            line_color: 0.6, 0.2, 0.8, 1
            on_release: root.export_to_csv()
        
        MDButton:
            text: "Share Results"
            style: "text"
            size_hint_x: 0.34
            theme_text_color: "Custom"
            text_color: 0.6, 0.2, 0.8, 1
            on_release: root.share_results()
    
    # Analysis actions
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(8)
        size_hint_x: 0.4
        
        MDButton:
            text: "Clear Results"
            style: "text"
            size_hint_x: 0.5
            theme_text_color: "Custom"
            text_color: 0.8, 0.4, 0.4, 1
            on_release: root.clear_results()
        
        MDButton:
            text: "View Details"
            style: "text"
            size_hint_x: 0.5
            theme_text_color: "Custom"
            text_color: 0.6, 0.6, 0.6, 1
            on_release: root.show_detailed_text_results()

# Analysis Type Selection Dialog
<AnalysisTypeDialog@MDDialog>:
    id: analysis_type_dialog
    
    MDDialogHeadlineText:
        text: "Analysis Type Selection"
    
    MDDialogSupportingText:
        text: "Choose the type of qualitative analysis to perform"
    
    MDBoxLayout:
        orientation: 'vertical'
        spacing: dp(8)
        size_hint_y: None
        height: dp(300)
        padding: [dp(16), dp(16), dp(16), dp(16)]
        
        MDScrollView:
            size_hint_y: None
            height: dp(240)
            
            MDBoxLayout:
                orientation: 'vertical'
                spacing: dp(8)
                size_hint_y: None
                height: self.minimum_height
                
                # Core Analysis Types
                MDButton:
                    text: "Text Analysis"
                    style: "outlined"
                    size_hint_y: None
                    height: dp(40)
                    theme_outline_color: "Custom"
                    line_color: 0.6, 0.2, 0.8, 1
                    on_release: root.run_analysis_by_type("text")
                
                MDButton:
                    text: "Sentiment Analysis"
                    style: "outlined"
                    size_hint_y: None
                    height: dp(40)
                    theme_outline_color: "Custom"
                    line_color: 0.2, 0.8, 0.6, 1
                    on_release: root.run_analysis_by_type("sentiment")
                
                MDButton:
                    text: "Theme Analysis"
                    style: "outlined"
                    size_hint_y: None
                    height: dp(40)
                    theme_outline_color: "Custom"
                    line_color: 0.6, 0.2, 0.8, 1
                    on_release: root.run_analysis_by_type("themes")
                
                MDButton:
                    text: "Word Frequency Analysis"
                    style: "outlined"
                    size_hint_y: None
                    height: dp(40)
                    theme_outline_color: "Custom"
                    line_color: 0.8, 0.6, 0.2, 1
                    on_release: root.run_analysis_by_type("word_frequency")
                
                # Advanced Analysis Types
                MDButton:
                    text: "Content Analysis"
                    style: "outlined"
                    size_hint_y: None
                    height: dp(40)
                    theme_outline_color: "Custom"
                    line_color: 0.4, 0.2, 0.8, 1
                    on_release: root.run_analysis_by_type("content_analysis")
                
                MDButton:
                    text: "Qualitative Coding"
                    style: "outlined"
                    size_hint_y: None
                    height: dp(40)
                    theme_outline_color: "Custom"
                    line_color: 0.8, 0.2, 0.4, 1
                    on_release: root.run_analysis_by_type("qualitative_coding")
                
                MDButton:
                    text: "Survey Analysis"
                    style: "outlined"
                    size_hint_y: None
                    height: dp(40)
                    theme_outline_color: "Custom"
                    line_color: 0.2, 0.6, 0.8, 1
                    on_release: root.run_analysis_by_type("survey_analysis")
                
                MDButton:
                    text: "Qualitative Statistics"
                    style: "outlined"
                    size_hint_y: None
                    height: dp(40)
                    theme_outline_color: "Custom"
                    line_color: 0.6, 0.8, 0.2, 1
                    on_release: root.run_analysis_by_type("qualitative_statistics")
                
                # Specialized Analysis Types
                MDButton:
                    text: "Sentiment Trends"
                    style: "text"
                    size_hint_y: None
                    height: dp(40)
                    theme_text_color: "Custom"
                    text_color: 0.2, 0.8, 0.6, 1
                    on_release: root.run_analysis_by_type("sentiment_trends")
                
                MDButton:
                    text: "Text Similarity"
                    style: "text"
                    size_hint_y: None
                    height: dp(40)
                    theme_text_color: "Custom"
                    text_color: 0.8, 0.4, 0.2, 1
                    on_release: root.run_analysis_by_type("text_similarity")
                
                MDButton:
                    text: "Theme Evolution"
                    style: "text"
                    size_hint_y: None
                    height: dp(40)
                    theme_text_color: "Custom"
                    text_color: 0.6, 0.2, 0.8, 1
                    on_release: root.run_analysis_by_type("theme_evolution")
                
                MDButton:
                    text: "Quote Extraction"
                    style: "text"
                    size_hint_y: None
                    height: dp(40)
                    theme_text_color: "Custom"
                    text_color: 0.8, 0.6, 0.4, 1
                    on_release: root.run_analysis_by_type("quote_extraction")
    
    MDDialogButtonContainer:
        MDButton:
            text: "Close"
            style: "text"
            on_release: analysis_type_dialog.dismiss()

# Text Results Display Component
<TextResultsDisplay@MDCard>:
    text_data: {}
    
    orientation: 'vertical'
    size_hint_y: None
    height: dp(300)
    elevation: 1
    md_bg_color: 1.0, 0.99, 1.0, 1
    radius: [8, 8, 8, 8]
    padding: [dp(12), dp(12), dp(12), dp(12)]
    spacing: dp(8)
    
    MDLabel:
        text: "Text Analysis Complete!"
        theme_text_color: "Primary"
        font_style: "Body"
        role: "medium"
        bold: True
        size_hint_y: None
        height: dp(24)
    
    GridLayout:
        cols: 2
        spacing: dp(8)
        size_hint_y: None
        height: dp(160)
        
        MDLabel:
            text: f"Field Analyzed: {root.text_data.get('field_analyzed', 'N/A')}"
            theme_text_color: "Primary"
            font_style: "Body"
            role: "small"
        
        MDLabel:
            text: f"Total Entries: {root.text_data.get('total_entries', 'N/A')}"
            theme_text_color: "Secondary"
            font_style: "Body"
            role: "small"
        
        MDLabel:
            text: f"Average Length: {root.text_data.get('average_length', 0):.1f} chars"
            theme_text_color: "Secondary"
            font_style: "Body"
            role: "small"
        
        MDLabel:
            text: f"Word Count: {root.text_data.get('word_count', 'N/A')}"
            theme_text_color: "Secondary"
            font_style: "Body"
            role: "small"
        
        MDLabel:
            text: f"Unique Entries: {root.text_data.get('unique_entries', 'N/A')}"
            theme_text_color: "Secondary"
            font_style: "Body"
            role: "small"
    
    # Action buttons
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(8)
        size_hint_y: None
        height: dp(40)
        
        MDButton:
            text: "View Details"
            style: "filled"
            size_hint_x: 0.6
            theme_bg_color: "Custom"
            md_bg_color: 0.6, 0.2, 0.8, 1
            on_release: root.show_detailed_text_results()
        
        MDButton:
            text: "Export"
            style: "outlined"
            size_hint_x: 0.4
            theme_outline_color: "Custom"
            line_color: 0.6, 0.6, 0.6, 1
            on_release: root.export_text_results()

# Sentiment Analysis Display Component
<SentimentAnalysisDisplay@MDCard>:
    sentiment_data: {}
    
    orientation: 'vertical'
    size_hint_y: None
    height: dp(350)
    elevation: 1
    md_bg_color: 0.98, 1.0, 0.98, 1
    radius: [8, 8, 8, 8]
    padding: [dp(12), dp(12), dp(12), dp(12)]
    spacing: dp(8)
    
    MDLabel:
        text: "Sentiment Analysis Results"
        theme_text_color: "Primary"
        font_style: "Body"
        role: "medium"
        bold: True
        size_hint_y: None
        height: dp(24)
    
    # Sentiment distribution grid
    GridLayout:
        cols: 3
        spacing: dp(8)
        size_hint_y: None
        height: dp(120)
        
        # Positive sentiment
        MDCard:
            orientation: 'vertical'
            padding: dp(8)
            md_bg_color: 0.2, 0.8, 0.2, 0.2
            elevation: 1
            radius: [8, 8, 8, 8]
            
            MDLabel:
                text: "Positive"
                theme_text_color: "Custom"
                text_color: 0.2, 0.8, 0.2, 1
                font_style: "Body"
                role: "small"
                halign: "center"
                size_hint_y: None
                height: dp(20)
            
            MDLabel:
                text: str(root.sentiment_data.get('sentiment_distribution', [{}])[0].get('count', 0))
                theme_text_color: "Custom"
                text_color: 0.2, 0.8, 0.2, 1
                font_style: "Headline"
                role: "small"
                halign: "center"
                size_hint_y: None
                height: dp(30)
        
        # Neutral sentiment
        MDCard:
            orientation: 'vertical'
            padding: dp(8)
            md_bg_color: 0.5, 0.5, 0.5, 0.2
            elevation: 1
            radius: [8, 8, 8, 8]
            
            MDLabel:
                text: "Neutral"
                theme_text_color: "Custom"
                text_color: 0.5, 0.5, 0.5, 1
                font_style: "Body"
                role: "small"
                halign: "center"
                size_hint_y: None
                height: dp(20)
            
            MDLabel:
                text: str(root.sentiment_data.get('sentiment_distribution', [{}, {}])[1].get('count', 0))
                theme_text_color: "Custom"
                text_color: 0.5, 0.5, 0.5, 1
                font_style: "Headline"
                role: "small"
                halign: "center"
                size_hint_y: None
                height: dp(30)
        
        # Negative sentiment
        MDCard:
            orientation: 'vertical'
            padding: dp(8)
            md_bg_color: 0.8, 0.2, 0.2, 0.2
            elevation: 1
            radius: [8, 8, 8, 8]
            
            MDLabel:
                text: "Negative"
                theme_text_color: "Custom"
                text_color: 0.8, 0.2, 0.2, 1
                font_style: "Body"
                role: "small"
                halign: "center"
                size_hint_y: None
                height: dp(20)
            
            MDLabel:
                text: str(root.sentiment_data.get('sentiment_distribution', [{}, {}, {}])[2].get('count', 0))
                theme_text_color: "Custom"
                text_color: 0.8, 0.2, 0.2, 1
                font_style: "Headline"
                role: "small"
                halign: "center"
                size_hint_y: None
                height: dp(30)
    
    # Overall sentiment summary
    MDBoxLayout:
        orientation: 'vertical'
        spacing: dp(4)
        size_hint_y: None
        height: dp(80)
        
        MDLabel:
            text: f"Overall Sentiment: {root.sentiment_data.get('overall_sentiment', 'neutral').title()}"
            theme_text_color: "Primary"
            font_style: "Body"
            role: "medium"
            size_hint_y: None
            height: dp(24)
        
        MDLabel:
            text: f"Confidence: {root.sentiment_data.get('confidence', 0):.2f}"
            theme_text_color: "Secondary"
            font_style: "Body"
            role: "small"
            size_hint_y: None
            height: dp(20)
        
        MDLabel:
            text: f"Total Analyzed: {root.sentiment_data.get('total_analyzed', 0)} responses"
            theme_text_color: "Secondary"
            font_style: "Body"
            role: "small"
            size_hint_y: None
            height: dp(20)

# Theme Analysis Display Component
<ThemeAnalysisDisplay@MDCard>:
    theme_data: []
    
    orientation: 'vertical'
    size_hint_y: None
    height: dp(350)
    elevation: 1
    md_bg_color: 0.99, 0.98, 1.0, 1
    radius: [8, 8, 8, 8]
    padding: [dp(12), dp(12), dp(12), dp(12)]
    spacing: dp(8)
    
    MDLabel:
        text: "Theme Analysis Results"
        theme_text_color: "Primary"
        font_style: "Body"
        role: "medium"
        bold: True
        size_hint_y: None
        height: dp(24)
    
    # Themes list
    MDScrollView:
        do_scroll_x: False
        do_scroll_y: True
        bar_width: dp(8)
        
        MDBoxLayout:
            orientation: 'vertical'
            spacing: dp(4)
            size_hint_y: None
            height: self.minimum_height
            
            # Theme items - populated dynamically based on theme_data

# Word Frequency Display Component
<WordFrequencyDisplay@MDCard>:
    word_data: []
    
    orientation: 'vertical'
    size_hint_y: None
    height: dp(350)
    elevation: 1
    md_bg_color: 1.0, 0.99, 0.98, 1
    radius: [8, 8, 8, 8]
    padding: [dp(12), dp(12), dp(12), dp(12)]
    spacing: dp(8)
    
    MDLabel:
        text: "Most Common Words"
        theme_text_color: "Primary"
        font_style: "Body"
        role: "medium"
        bold: True
        size_hint_y: None
        height: dp(24)
    
    # Word frequency list
    MDScrollView:
        do_scroll_x: False
        do_scroll_y: True
        bar_width: dp(8)
        
        MDBoxLayout:
            orientation: 'vertical'
            spacing: dp(4)
            size_hint_y: None
            height: self.minimum_height
            
            # Word items - populated dynamically based on word_data

# Empty Results State Component
<QualitativeEmptyResults@MDBoxLayout>:
    orientation: 'vertical'
    spacing: dp(20)
    size_hint_y: None
    height: dp(300)
    padding: [dp(40), dp(30), dp(40), dp(30)]
    
    MDIconButton:
        icon: "text-box-outline"
        theme_icon_color: "Custom"
        icon_color: 0.6, 0.6, 0.6, 1
        disabled: True
        size_hint: None, None
        size: dp(48), dp(48)
        pos_hint: {'center_x': 0.5}
    
    MDLabel:
        text: "No text analysis results yet"
        theme_text_color: "Secondary"
        font_style: "Headline"
        role: "small"
        halign: "center"
    
    MDLabel:
        text: "Select a project and run text analysis to see qualitative insights"
        theme_text_color: "Hint"
        font_style: "Body"
        role: "medium"
        halign: "center"
        text_size: dp(300), None

# Loading State Component
<QualitativeLoadingCard@MDCard>:
    orientation: 'vertical'
    size_hint_y: None
    height: dp(300)
    elevation: 3
    md_bg_color: 0.98, 1.0, 0.98, 1
    radius: [12, 12, 12, 12]
    padding: [dp(40), dp(30), dp(40), dp(30)]
    spacing: dp(24)
    
    MDCircularProgressIndicator:
        size_hint: None, None
        size: dp(48), dp(48)
        pos_hint: {'center_x': 0.5}
    
    MDLabel:
        text: "Running text analysis..."
        theme_text_color: "Secondary"
        font_style: "Headline"
        role: "small"
        halign: "center"
    
    MDLabel:
        text: "Please wait while we analyze your qualitative data"
        theme_text_color: "Hint"
        font_style: "Body"
        role: "medium"
        halign: "center"

# Error State Component
<QualitativeErrorCard@MDCard>:
    error_message: ""
    
    orientation: 'vertical'
    size_hint_y: None
    height: dp(300)
    elevation: 3
    md_bg_color: 1.0, 0.96, 0.96, 1
    radius: [12, 12, 12, 12]
    padding: [dp(40), dp(30), dp(40), dp(30)]
    spacing: dp(24)
    
    MDIconButton:
        icon: "alert-circle-outline"
        theme_icon_color: "Custom"
        icon_color: 0.8, 0.2, 0.2, 1
        disabled: True
        size_hint: None, None
        size: dp(64), dp(64)
        pos_hint: {'center_x': 0.5}
    
    MDLabel:
        text: f"Text Analysis Error: {root.error_message}"
        theme_text_color: "Error"
        font_style: "Headline"
        role: "small"
        halign: "center"
        text_size: dp(400), None
    
    MDLabel:
        text: "Please try again or contact support if the issue persists"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        halign: "center"
    
    MDButton:
        text: "Retry Analysis"
        style: "filled"
        size_hint: None, None
        size: dp(140), dp(40)
        pos_hint: {'center_x': 0.5}
        theme_bg_color: "Custom"
        md_bg_color: 0.6, 0.2, 0.8, 1 