#:kivy 2.0
#:import MDCard kivymd.uix.card.MDCard
#:import MDScrollView kivymd.uix.scrollview.MDScrollView
#:import MDLabel kivymd.uix.label.MDLabel
#:import MDButton kivymd.uix.button.MDButton
#:import MDIconButton kivymd.uix.button.MDIconButton
#:import MDBoxLayout kivymd.uix.boxlayout.MDBoxLayout
#:import MDTextField kivymd.uix.textfield.MDTextField
#:import MDCheckbox kivymd.uix.selectioncontrol.MDCheckbox
#:import MDDropdownMenu kivymd.uix.menu.MDDropdownMenu
#:import MDCircularProgressIndicator kivymd.uix.progressindicator.MDCircularProgressIndicator
#:import MDDialog kivymd.uix.dialog.MDDialog
#:import MDDialogHeadlineText kivymd.uix.dialog.MDDialogHeadlineText
#:import MDDialogSupportingText kivymd.uix.dialog.MDDialogSupportingText
#:import MDDialogButtonContainer kivymd.uix.dialog.MDDialogButtonContainer
#:import GridLayout kivy.uix.gridlayout.GridLayout
#:import dp kivy.metrics.dp

# Main Auto Detection Screen Layout
<AutoDetectionScreen>:
    name: 'auto_detection'
    
    MDScrollView:
        MDBoxLayout:
            id: main_content
            orientation: 'vertical'
            spacing: dp(16)
            padding: [dp(24), dp(8), dp(24), dp(20)]
            size_hint_y: None
            height: self.minimum_height
            
            # Top Navigation Bar
            TopBar:
                id: top_bar
                size_hint_y: None
                height: dp(56)
            
            # Project Selection Card
            AutoDetectionProjectCard:
                id: project_selection_card
            
            # Analysis Controls Card
            AutoDetectionControlsCard:
                id: analysis_controls_card
            
            # Data Overview Card
            AutoDetectionDataOverviewCard:
                id: data_overview_card
            
            # Recommendations Card
            AutoDetectionRecommendationsCard:
                id: recommendations_card
            
            # Analysis Results Card
            AutoDetectionResultsCard:
                id: results_card
            
            # Action Buttons Card
            AutoDetectionActionsCard:
                id: actions_card

# Project Selection Card Component
<AutoDetectionProjectCard@MDCard>:
    orientation: 'horizontal'
    size_hint_y: None
    height: dp(64)
    elevation: 2
    md_bg_color: 0.98, 0.99, 1.0, 1
    radius: [12, 12, 12, 12]
    padding: [dp(20), dp(12), dp(20), dp(12)]
    spacing: dp(16)
    
    # Title Section
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(12)
        size_hint_x: 0.4
        
        MDIconButton:
            icon: "auto-fix"
            theme_icon_color: "Custom"
            icon_color: app.theme_cls.primaryColor
            size_hint_x: None
            width: dp(36)
            icon_size: "20dp"
            disabled: True
        
        MDLabel:
            text: "Auto Detection Analytics"
            theme_text_color: "Primary"
            font_style: "Headline"
            role: "small"
            bold: True
            halign: "left"
            valign: "center"
    
    # Project Selector
    MDButton:
        id: project_selector
        text: "Select Project"
        style: "filled"
        size_hint_x: 0.4
        theme_bg_color: "Custom"
        md_bg_color: app.theme_cls.primaryColor
        on_release: root.show_project_menu()
    
    # Analysis Status
    MDLabel:
        id: analysis_status_label
        text: "Status: Ready"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        size_hint_x: 0.2
        halign: "right"
        valign: "center"

# Analysis Controls Card Component
<AutoDetectionControlsCard@MDCard>:
    orientation: 'vertical'
    size_hint_y: None
    height: dp(180)
    elevation: 3
    md_bg_color: 0.98, 0.99, 1.0, 1
    radius: [12, 12, 12, 12]
    padding: [dp(16), dp(16), dp(16), dp(16)]
    spacing: dp(12)
    
    # Header
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(12)
        size_hint_y: None
        height: dp(36)
        
        MDIconButton:
            icon: "play-circle"
            theme_icon_color: "Custom"
            icon_color: 0.2, 0.7, 0.2, 1
            disabled: True
            size_hint: None, None
            size: dp(32), dp(32)
        
        MDLabel:
            text: "Analysis Controls"
            theme_text_color: "Primary"
            font_style: "Headline"
            role: "small"
            bold: True
            size_hint_y: None
            height: dp(36)
        
        MDLabel:
            id: analysis_count_label
            text: "0 analyses completed"
            theme_text_color: "Secondary"
            font_style: "Body"
            role: "medium"
            halign: "right"
            size_hint_y: None
            height: dp(36)
    
    # Main analysis button
    MDButton:
        text: "Run Auto Detection"
        style: "filled"
        size_hint_y: None
        height: dp(48)
        theme_bg_color: "Custom"
        md_bg_color: 0.2, 0.7, 0.2, 1
        on_release: root.run_auto_detection()
    
    # Quick analysis buttons row
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(8)
        size_hint_y: None
        height: dp(40)
        
        MDButton:
            text: "Basic Stats"
            style: "outlined"
            size_hint_x: 0.2
            theme_outline_color: "Custom"
            line_color: app.theme_cls.primaryColor
            on_release: root.run_basic_statistics()
        
        MDButton:
            text: "Distribution"
            style: "outlined"
            size_hint_x: 0.2
            theme_outline_color: "Custom"
            line_color: app.theme_cls.primaryColor
            on_release: root.run_distribution_analysis()
        
        MDButton:
            text: "Correlation"
            style: "outlined"
            size_hint_x: 0.2
            theme_outline_color: "Custom"
            line_color: app.theme_cls.primaryColor
            on_release: root.run_correlation_analysis()
        
        MDButton:
            text: "Outliers"
            style: "outlined"
            size_hint_x: 0.2
            theme_outline_color: "Custom"
            line_color: app.theme_cls.primaryColor
            on_release: root.run_outlier_analysis()
        
        MDButton:
            text: "More"
            style: "text"
            size_hint_x: 0.2
            theme_text_color: "Custom"
            text_color: app.theme_cls.primaryColor
            on_release: root.show_analysis_type_dialog()
    
    # Variable selection row
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(8)
        size_hint_y: None
        height: dp(32)
        
        MDButton:
            text: "Select Variables"
            style: "text"
            size_hint_x: 0.3
            theme_text_color: "Custom"
            text_color: app.theme_cls.primaryColor
            on_release: root.show_variable_selection_dialog()
        
        MDLabel:
            id: variable_selection_info_label
            text: "0/0 variables selected"
            theme_text_color: "Secondary"
            font_style: "Body"
            role: "small"
            size_hint_x: 0.4
            halign: "center"
        
        MDButton:
            text: "Refresh"
            style: "text"
            size_hint_x: 0.3
            theme_text_color: "Custom"
            text_color: 0.6, 0.6, 0.6, 1
            on_release: root.refresh_analysis()

# Data Overview Card Component
<AutoDetectionDataOverviewCard@MDCard>:
    orientation: 'vertical'
    size_hint_y: None
    height: dp(200)
    elevation: 2
    md_bg_color: 0.97, 0.98, 1.0, 1
    radius: [12, 12, 12, 12]
    padding: [dp(16), dp(16), dp(16), dp(16)]
    spacing: dp(12)
    
    # Header
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(12)
        size_hint_y: None
        height: dp(36)
        
        MDIconButton:
            icon: "chart-bar"
            theme_icon_color: "Custom"
            icon_color: 0.13, 0.59, 0.95, 1
            disabled: True
            size_hint: None, None
            size: dp(32), dp(32)
        
        MDLabel:
            text: "Data Overview"
            theme_text_color: "Primary"
            font_style: "Headline"
            role: "small"
            bold: True
    
    # Statistics row
    MDBoxLayout:
        id: data_overview_content
        orientation: 'horizontal'
        spacing: dp(16)
        size_hint_y: None
        height: dp(80)
        
        # Total responses stat
        MDBoxLayout:
            orientation: 'vertical'
            size_hint_x: 0.25
            spacing: dp(4)
            
            MDLabel:
                id: total_responses_label
                text: "0 responses"
                theme_text_color: "Primary"
                font_style: "Headline"
                role: "medium"
                bold: True
                halign: "center"
            
            MDLabel:
                text: "Total Responses"
                theme_text_color: "Secondary"
                font_style: "Body"
                role: "small"
                halign: "center"
        
        # Total questions stat
        MDBoxLayout:
            orientation: 'vertical'
            size_hint_x: 0.25
            spacing: dp(4)
            
            MDLabel:
                id: total_questions_label
                text: "0 questions"
                theme_text_color: "Primary"
                font_style: "Headline"
                role: "medium"
                bold: True
                halign: "center"
            
            MDLabel:
                text: "Total Questions"
                theme_text_color: "Secondary"
                font_style: "Body"
                role: "small"
                halign: "center"
        
        # Data quality stat
        MDBoxLayout:
            orientation: 'vertical'
            size_hint_x: 0.25
            spacing: dp(4)
            
            MDLabel:
                id: data_quality_label
                text: "0%"
                theme_text_color: "Primary"
                font_style: "Headline"
                role: "medium"
                bold: True
                halign: "center"
            
            MDLabel:
                text: "Data Quality"
                theme_text_color: "Secondary"
                font_style: "Body"
                role: "small"
                halign: "center"
        
        # Missing data stat
        MDBoxLayout:
            orientation: 'vertical'
            size_hint_x: 0.25
            spacing: dp(4)
            
            MDLabel:
                id: missing_data_label
                text: "0%"
                theme_text_color: "Primary"
                font_style: "Headline"
                role: "medium"
                bold: True
                halign: "center"
            
            MDLabel:
                text: "Missing Data"
                theme_text_color: "Secondary"
                font_style: "Body"
                role: "small"
                halign: "center"
    
    # Quick insights
    MDBoxLayout:
        orientation: 'vertical'
        spacing: dp(4)
        size_hint_y: None
        height: dp(60)
        
        MDLabel:
            text: "Quick Insights"
            theme_text_color: "Primary"
            font_style: "Body"
            role: "medium"
            bold: True
        
        MDLabel:
            id: quick_insights_label
            text: "Run analysis to see insights"
            theme_text_color: "Secondary"
            font_style: "Body"
            role: "small"
            text_size: self.width, None

# Recommendations Card Component
<AutoDetectionRecommendationsCard@MDCard>:
    orientation: 'vertical'
    size_hint_y: None
    height: dp(200)
    elevation: 2
    md_bg_color: 0.98, 1.0, 0.98, 1
    radius: [12, 12, 12, 12]
    padding: [dp(16), dp(16), dp(16), dp(16)]
    spacing: dp(12)
    
    # Header
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(12)
        size_hint_y: None
        height: dp(36)
        
        MDIconButton:
            icon: "lightbulb-on"
            theme_icon_color: "Custom"
            icon_color: 0.8, 0.6, 0.2, 1
            disabled: True
            size_hint: None, None
            size: dp(32), dp(32)
        
        MDLabel:
            text: "Smart Recommendations"
            theme_text_color: "Primary"
            font_style: "Headline"
            role: "small"
            bold: True
    
    # Recommendations content
    MDScrollView:
        id: recommendations_content
        do_scroll_x: False
        do_scroll_y: True
        bar_width: dp(8)
        
        MDBoxLayout:
            id: recommendations_list
            orientation: 'vertical'
            spacing: dp(8)
            size_hint_y: None
            height: self.minimum_height
            
            # Default message when no recommendations
            MDLabel:
                text: "Run auto detection to see smart recommendations"
                theme_text_color: "Secondary"
                font_style: "Body"
                role: "medium"
                halign: "center"
                size_hint_y: None
                height: dp(100)

# Analysis Results Card Component
<AutoDetectionResultsCard@MDCard>:
    orientation: 'vertical'
    size_hint_y: None
    height: dp(400)
    elevation: 2
    md_bg_color: 1, 1, 1, 1
    radius: [12, 12, 12, 12]
    padding: [dp(16), dp(16), dp(16), dp(16)]
    spacing: dp(12)
    
    # Header
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(12)
        size_hint_y: None
        height: dp(36)
        
        MDIconButton:
            icon: "chart-line-variant"
            theme_icon_color: "Custom"
            icon_color: app.theme_cls.primaryColor
            disabled: True
            size_hint: None, None
            size: dp(32), dp(32)
        
        MDLabel:
            text: "Analysis Results"
            theme_text_color: "Primary"
            font_style: "Headline"
            role: "small"
            bold: True
        
        # Result type tabs
        MDBoxLayout:
            orientation: 'horizontal'
            spacing: dp(4)
            size_hint_x: 0.5
            
            MDButton:
                id: basic_stats_tab
                text: "Basic"
                style: "text"
                size_hint_x: 0.25
                theme_text_color: "Custom"
                text_color: app.theme_cls.primaryColor
            
            MDButton:
                id: distribution_tab
                text: "Distribution"
                style: "text"
                size_hint_x: 0.25
                theme_text_color: "Custom"
                text_color: 0.6, 0.6, 0.6, 1
            
            MDButton:
                id: correlation_tab
                text: "Correlation"
                style: "text"
                size_hint_x: 0.25
                theme_text_color: "Custom"
                text_color: 0.6, 0.6, 0.6, 1
            
            MDButton:
                id: advanced_tab
                text: "Advanced"
                style: "text"
                size_hint_x: 0.25
                theme_text_color: "Custom"
                text_color: 0.6, 0.6, 0.6, 1
    
    # Results content
    MDScrollView:
        id: results_content
        do_scroll_x: False
        do_scroll_y: True
        bar_width: dp(8)
        
        MDBoxLayout:
            id: results_display
            orientation: 'vertical'
            spacing: dp(12)
            size_hint_y: None
            height: self.minimum_height
            
            # Default message when no results
            AutoDetectionEmptyResults:

# Action Buttons Card Component
<AutoDetectionActionsCard@MDCard>:
    orientation: 'horizontal'
    size_hint_y: None
    height: dp(80)
    elevation: 2
    md_bg_color: 0.96, 0.96, 0.96, 1
    radius: [12, 12, 12, 12]
    padding: [dp(16), dp(12), dp(16), dp(12)]
    spacing: dp(12)
    
    # Export actions
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(8)
        size_hint_x: 0.6
        
        MDButton:
            text: "Export JSON"
            style: "filled"
            size_hint_x: 0.33
            theme_bg_color: "Custom"
            md_bg_color: 0.2, 0.6, 0.8, 1
            on_release: root.export_to_json()
        
        MDButton:
            text: "Export CSV"
            style: "outlined"
            size_hint_x: 0.33
            theme_outline_color: "Custom"
            line_color: 0.2, 0.6, 0.8, 1
            on_release: root.export_to_csv()
        
        MDButton:
            text: "Share Results"
            style: "text"
            size_hint_x: 0.34
            theme_text_color: "Custom"
            text_color: 0.2, 0.6, 0.8, 1
            on_release: root.share_results()
    
    # Analysis actions
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(8)
        size_hint_x: 0.4
        
        MDButton:
            text: "Clear Results"
            style: "text"
            size_hint_x: 0.5
            theme_text_color: "Custom"
            text_color: 0.8, 0.4, 0.4, 1
            on_release: root.clear_results()
        
        MDButton:
            text: "Advanced Options"
            style: "text"
            size_hint_x: 0.5
            theme_text_color: "Custom"
            text_color: 0.6, 0.6, 0.6, 1
            on_release: root.show_analysis_type_dialog()

# Variable Selection Dialog
<VariableSelectionDialog@MDDialog>:
    id: variable_selection_dialog
    
    MDDialogHeadlineText:
        text: "Select Variables for Analysis"
    
    MDDialogSupportingText:
        text: "Choose the variables you want to include in the analysis"
    
    MDScrollView:
        size_hint_y: None
        height: dp(300)
        
        MDBoxLayout:
            orientation: 'vertical'
            spacing: dp(8)
            size_hint_y: None
            height: self.minimum_height
            padding: [dp(16), dp(16), dp(16), dp(16)]
            
            # Select all/none buttons
            MDBoxLayout:
                orientation: 'horizontal'
                spacing: dp(8)
                size_hint_y: None
                height: dp(32)
                
                MDButton:
                    text: "Select All"
                    style: "text"
                    size_hint_x: 0.5
                    theme_text_color: "Custom"
                    text_color: app.theme_cls.primaryColor
                    on_release: root.select_all_variables()
                
                MDButton:
                    text: "Clear All"
                    style: "text"
                    size_hint_x: 0.5
                    theme_text_color: "Custom"
                    text_color: 0.6, 0.6, 0.6, 1
                    on_release: root.clear_variable_selection()
            
            # Variables list (populated dynamically)
            MDBoxLayout:
                id: variables_list
                orientation: 'vertical'
                spacing: dp(4)
                size_hint_y: None
                height: self.minimum_height
    
    MDDialogButtonContainer:
        MDButton:
            text: "Cancel"
            style: "text"
            on_release: variable_selection_dialog.dismiss()
        
        MDButton:
            text: "Apply Selection"
            style: "filled"
            theme_bg_color: "Custom"
            md_bg_color: app.theme_cls.primaryColor
            on_release: root.run_analysis_with_variables(root.get_selected_variables_list())

# Analysis Type Selection Dialog
<AnalysisTypeDialog@MDDialog>:
    id: analysis_type_dialog
    
    MDDialogHeadlineText:
        text: "Select Analysis Type"
    
    MDDialogSupportingText:
        text: "Choose the type of analysis you want to run"
    
    MDBoxLayout:
        orientation: 'vertical'
        spacing: dp(8)
        size_hint_y: None
        height: dp(300)
        padding: [dp(16), dp(16), dp(16), dp(16)]
        
        # Analysis type buttons
        MDButton:
            text: "Comprehensive Analysis"
            style: "outlined"
            size_hint_y: None
            height: dp(48)
            theme_outline_color: "Custom"
            line_color: app.theme_cls.primaryColor
            on_release: root.run_comprehensive_analysis()
        
        MDButton:
            text: "Categorical Analysis"
            style: "outlined"
            size_hint_y: None
            height: dp(48)
            theme_outline_color: "Custom"
            line_color: app.theme_cls.primaryColor
            on_release: root.run_categorical_analysis()
        
        MDButton:
            text: "Missing Data Analysis"
            style: "outlined"
            size_hint_y: None
            height: dp(48)
            theme_outline_color: "Custom"
            line_color: app.theme_cls.primaryColor
            on_release: root.run_missing_data_analysis()
        
        MDButton:
            text: "Custom Analysis"
            style: "text"
            size_hint_y: None
            height: dp(48)
            theme_text_color: "Custom"
            text_color: 0.6, 0.6, 0.6, 1
    
    MDDialogButtonContainer:
        MDButton:
            text: "Close"
            style: "text"
            on_release: analysis_type_dialog.dismiss()

# Analysis Results Dialog
<AnalysisResultsDialog@MDDialog>:
    id: results_dialog
    
    MDDialogHeadlineText:
        id: results_dialog_title
        text: "Analysis Results"
    
    MDScrollView:
        size_hint_y: None
        height: dp(400)
        
        MDBoxLayout:
            orientation: 'vertical'
            spacing: dp(12)
            size_hint_y: None
            height: self.minimum_height
            padding: [dp(16), dp(16), dp(16), dp(16)]
            
            MDLabel:
                id: results_dialog_content
                text: "Results will appear here"
                theme_text_color: "Primary"
                font_style: "Body"
                role: "medium"
                text_size: self.width, None
    
    MDDialogButtonContainer:
        MDButton:
            text: "Export"
            style: "text"
            theme_text_color: "Custom"
            text_color: app.theme_cls.primaryColor
            on_release: root.export_results()
        
        MDButton:
            text: "Close"
            style: "filled"
            theme_bg_color: "Custom"
            md_bg_color: app.theme_cls.primaryColor
            on_release: results_dialog.dismiss()

# Recommendation Item Component
<RecommendationItem@MDCard>:
    recommendation_title: ""
    recommendation_description: ""
    recommendation_id: ""
    
    orientation: 'vertical'
    size_hint_y: None
    height: dp(80)
    elevation: 1
    md_bg_color: 0.99, 0.99, 0.99, 1
    radius: [8, 8, 8, 8]
    padding: [dp(12), dp(8), dp(12), dp(8)]
    spacing: dp(4)
    
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(8)
        
        MDBoxLayout:
            orientation: 'vertical'
            spacing: dp(2)
            size_hint_x: 0.8
            
            MDLabel:
                text: root.recommendation_title
                theme_text_color: "Primary"
                font_style: "Body"
                role: "medium"
                bold: True
                size_hint_y: None
                height: dp(20)
            
            MDLabel:
                text: root.recommendation_description
                theme_text_color: "Secondary"
                font_style: "Body"
                role: "small"
                text_size: self.width, None
                size_hint_y: None
                height: dp(36)
        
        MDBoxLayout:
            orientation: 'horizontal'
            spacing: dp(4)
            size_hint_x: 0.2
            
            MDIconButton:
                icon: "play"
                theme_icon_color: "Custom"
                icon_color: 0.2, 0.7, 0.2, 1
                size_hint: None, None
                size: dp(24), dp(24)
                on_release: root.run_recommended_analysis({"id": root.recommendation_id})
            
            MDIconButton:
                icon: "close"
                theme_icon_color: "Custom"
                icon_color: 0.6, 0.6, 0.6, 1
                size_hint: None, None
                size: dp(24), dp(24)
                on_release: root.dismiss_recommendation(root.recommendation_id)

# Empty Results State Component
<AutoDetectionEmptyResults@MDBoxLayout>:
    orientation: 'vertical'
    spacing: dp(20)
    size_hint_y: None
    height: dp(250)
    padding: [dp(40), dp(30), dp(40), dp(30)]
    
    MDIconButton:
        icon: "chart-bell-curve-cumulative"
        theme_icon_color: "Custom"
        icon_color: 0.6, 0.6, 0.6, 1
        disabled: True
        size_hint: None, None
        size: dp(48), dp(48)
        pos_hint: {'center_x': 0.5}
    
    MDLabel:
        text: "No analysis results yet"
        theme_text_color: "Secondary"
        font_style: "Headline"
        role: "small"
        halign: "center"
    
    MDLabel:
        text: "Select a project and run auto detection to see intelligent analysis results"
        theme_text_color: "Hint"
        font_style: "Body"
        role: "medium"
        halign: "center"
        text_size: dp(300), None

# Loading State Component
<AutoDetectionLoadingCard@MDCard>:
    orientation: 'vertical'
    size_hint_y: None
    height: dp(300)
    elevation: 3
    md_bg_color: 0.97, 0.98, 1.0, 1
    radius: [12, 12, 12, 12]
    padding: [dp(40), dp(30), dp(40), dp(30)]
    spacing: dp(24)
    
    MDCircularProgressIndicator:
        size_hint: None, None
        size: dp(48), dp(48)
        pos_hint: {'center_x': 0.5}
    
    MDLabel:
        text: "Running intelligent analysis..."
        theme_text_color: "Secondary"
        font_style: "Headline"
        role: "small"
        halign: "center"
    
    MDLabel:
        text: "Please wait while we analyze your data and generate insights"
        theme_text_color: "Hint"
        font_style: "Body"
        role: "medium"
        halign: "center"

# Error State Component
<AutoDetectionErrorCard@MDCard>:
    error_message: ""
    
    orientation: 'vertical'
    size_hint_y: None
    height: dp(300)
    elevation: 3
    md_bg_color: 1.0, 0.96, 0.96, 1
    radius: [12, 12, 12, 12]
    padding: [dp(40), dp(30), dp(40), dp(30)]
    spacing: dp(24)
    
    MDIconButton:
        icon: "alert-circle-outline"
        theme_icon_color: "Custom"
        icon_color: 0.8, 0.2, 0.2, 1
        disabled: True
        size_hint: None, None
        size: dp(64), dp(64)
        pos_hint: {'center_x': 0.5}
    
    MDLabel:
        text: f"Analysis Error: {root.error_message}"
        theme_text_color: "Error"
        font_style: "Headline"
        role: "small"
        halign: "center"
        text_size: dp(400), None
    
    MDLabel:
        text: "Please try again or contact support if the issue persists"
        theme_text_color: "Secondary"
        font_style: "Body"
        role: "medium"
        halign: "center"
    
    MDButton:
        text: "Retry Analysis"
        style: "filled"
        size_hint: None, None
        size: dp(140), dp(40)
        pos_hint: {'center_x': 0.5}
        theme_bg_color: "Custom"
        md_bg_color: app.theme_cls.primaryColor
        on_release: root.refresh_analysis() 