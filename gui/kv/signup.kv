#:import dp kivy.metrics.dp
#:import MDBoxLayout kivymd.uix.boxlayout.MDBoxLayout
#:import MDCard     kivymd.uix.card.MDCard
#:import MDButton kivymd.uix.button.MDButton
#:import MDButtonText kivymd.uix.button.MDButtonText
#:import MDTextField    kivymd.uix.textfield.MDTextField
#:import MDTextFieldHintText kivymd.uix.textfield.MDTextFieldHintText
#:import MDTextFieldTrailingIcon kivymd.uix.textfield.MDTextFieldTrailingIcon
#:import MDLabel        kivymd.uix.label.MDLabel
#:import MDCircularProgressIndicator kivymd.uix.progressindicator.MDCircularProgressIndicator
#:import MDIconButton kivymd.uix.button.MDIconButton
#:import FloatLayout kivy.uix.floatlayout.FloatLayout

<SignUpScreen>:
    name: "signup"
    # full-screen primary color background
    md_bg_color: app.theme_cls.primaryColor

    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"

        MDCard:
            elevation: 0
            radius: [dp(16)]
            # left, top, right, bottom padding
            padding: [dp(16), dp(8), dp(16), dp(24)]
            size_hint: None, None
            size: dp(400), dp(680)

            MDBoxLayout:
                orientation: "vertical"
                spacing: dp(20)

                MDBoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: dp(24)

                    MDIconButton:
                        icon: "arrow-left"
                        icon_size: "24sp"
                        disabled: root.is_registering
                        on_release: root.on_login()

                # Title
                MDLabel:
                    text: "Create Account"
                    font_style: "Display"
                    halign: "center"
                    size_hint_y: None
                    height: self.texture_size[1]

                # Username
                MDTextField:
                    id: username
                    mode: "outlined"
                    size_hint_y: None
                    height: dp(48)
                    disabled: root.is_registering

                    MDTextFieldHintText:
                        text: "Username"

                # First & Last name side by side
                MDBoxLayout:
                    orientation: "horizontal"
                    spacing: dp(12)
                    size_hint_y: None
                    height: dp(48)

                    MDTextField:
                        id: first_name
                        mode: "outlined"
                        disabled: root.is_registering

                        MDTextFieldHintText:
                            text: "First Name"

                    MDTextField:
                        id: last_name
                        mode: "outlined"
                        disabled: root.is_registering

                        MDTextFieldHintText:
                            text: "Last Name"

                # Email
                MDTextField:
                    id: email
                    mode: "outlined"
                    size_hint_y: None
                    height: dp(48)
                    disabled: root.is_registering

                    MDTextFieldHintText:
                        text: "Email Address"

                # Institution
                MDTextField:
                    id: institution
                    mode: "outlined"
                    size_hint_y: None
                    height: dp(48)
                    disabled: root.is_registering

                    MDTextFieldHintText:
                        text: "Institution"

                # Password with toggle
                FloatLayout:
                    size_hint_y: None
                    height: dp(48)

                    MDTextField:
                        id: password
                        mode: "outlined"
                        password: not root.password_visible
                        size_hint: 1, None
                        height: dp(48)
                        pos_hint: {"x": 0, "center_y": 0.5}
                        disabled: root.is_registering

                        MDTextFieldHintText:
                            text: "Password"

                        MDIconButton:
                            icon: "eye-off" if root.password_visible else "eye"
                            on_release: root.toggle_password_visibility()
                            pos_hint: {"center_y": 0.5}
                            pos: self.parent.width - self.width - dp(8), 0
                            theme_icon_color: "Custom"
                            icon_color: 0.5, 0.5, 0.5, 1

                # Confirm Password with toggle
                FloatLayout:
                    size_hint_y: None
                    height: dp(48)

                    MDTextField:
                        id: confirm_password
                        mode: "outlined"
                        password: not root.confirm_password_visible
                        size_hint: 1, None
                        height: dp(48)
                        pos_hint: {"x": 0, "center_y": 0.5}
                        disabled: root.is_registering

                        MDTextFieldHintText:
                            text: "Confirm Password"

                        MDIconButton:
                            icon: "eye-off" if root.confirm_password_visible else "eye"
                            on_release: root.toggle_confirm_password_visibility()
                            pos_hint: {"center_y": 0.5}
                            pos: self.parent.width - self.width - dp(8), 0
                            theme_icon_color: "Custom"
                            icon_color: 0.5, 0.5, 0.5, 1

                # Sign-Up button
                MDButton:
                    id: signup_button
                    style: "elevated"
                    size_hint: 1, None
                    height: dp(50)
                    disabled: root.is_registering
                    on_release: root.signup()
                    
                    MDButtonText:
                        text: "Sign Up"

                # Spinner container
                MDBoxLayout:
                    id: spinner_container
                    orientation: "horizontal"
                    adaptive_height: True
                    size_hint_y: None
                    height: dp(40) if root.is_registering else 0
                    opacity: 1 if root.is_registering else 0
                    spacing: dp(10)

                    MDCircularProgressIndicator:
                        id: signup_spinner
                        size_hint: None, None
                        size: dp(20), dp(20)
                        active: root.is_registering

                    MDLabel:
                        text: "Creating account..."
                        size_hint_y: None
                        height: self.texture_size[1]
                        font_size: dp(14)

                # Link back to Login
                MDLabel:
                    markup: True
                    text: "[color=888888]Already have an account? [/color][ref=login][color=377DFF]Login[/color][/ref]"
                    halign: "center"
                    size_hint_y: None
                    height: self.texture_size[1]
                    on_ref_press: root.on_login()
