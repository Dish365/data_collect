<DataCollectionScreen>:
    MDBoxLayout:
        orientation: 'vertical'
        spacing: 0
        md_bg_color: 0.96, 0.96, 0.96, 1

        # Simplified Header
        MDBoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(64)
            padding: [dp(16), dp(8), dp(16), dp(8)]
            spacing: dp(16)
            md_bg_color: 1, 1, 1, 1
            elevation: 1

            MDRaisedButton:
                text: "‚Üê"
                font_size: "24sp"
                size_hint: None, None
                size: dp(40), dp(40)
                padding: [0, 0]
                on_release: setattr(root.manager, 'current', 'dashboard')

            MDLabel:
                text: "Data Collection"
                font_style: "H6"
                bold: True
                theme_text_color: "Primary"
                size_hint_x: None
                width: dp(200)

            MDLabel:
                text: "Select Project"
                size_hint_x: None
                width: dp(120)
                font_style: "Subtitle1"
                theme_text_color: "Secondary"
                font_size: "16sp"

            MDDropDownItem:
                id: project_spinner
                text: 'Select Project'
                on_release: root.open_project_menu()
                pos_hint: {'center_y': 0.5}
                size_hint_x: None
                width: dp(200)
                font_size: '16sp'
                md_bg_color: app.theme_cls.primary_light
                radius: [8, 8, 8, 8]

            Widget:
                size_hint_x: 0.1

        # Main Content Area
        MDScrollView:
            do_scroll_x: False
            do_scroll_y: True
            bar_width: dp(4)
            bar_color: 0.8, 0.8, 0.8, 1

            MDBoxLayout:
                id: form_canvas
                orientation: 'vertical'
                spacing: dp(16)
                adaptive_height: True
                padding: [dp(16), dp(16), dp(16), dp(80)]  # Added bottom padding for submit button

                # Empty state when no project selected
                MDBoxLayout:
                    id: empty_state
                    orientation: 'vertical'
                    spacing: dp(16)
                    size_hint_y: None
                    height: dp(200)
                    opacity: 1

                    MDBoxLayout:
                        size_hint_y: None
                        height: dp(40)

                    MDLabel:
                        text: "üìã"
                        halign: "center"
                        font_size: "48sp"
                        size_hint_y: None
                        height: dp(64)
                        theme_text_color: "Hint"

                    MDLabel:
                        text: "No form loaded"
                        font_style: "H6"
                        theme_text_color: "Hint"
                        halign: "center"
                        font_size: "18sp"

                    MDLabel:
                        text: "Select a project to load its form"
                        font_style: "Body2"
                        theme_text_color: "Hint"
                        halign: "center"
                        font_size: "14sp"

        # Footer with Submit Button
        MDCard:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(64)
            padding: [dp(16), dp(8)]
            spacing: dp(12)
            elevation: 2
            md_bg_color: 1, 1, 1, 1
            pos_hint: {'center_x': 0.5}

            Widget:
                size_hint_x: 0.4

            MDRaisedButton:
                id: submit_button
                text: 'Submit New Response'
                md_bg_color: app.theme_cls.primary_color
                text_color: 1, 1, 1, 1
                font_size: "14sp"
                size_hint: None, None
                size: dp(180), dp(36)
                elevation: 1
                on_release: root.submit_response()
                pos_hint: {'center_y': 0.5}

            Widget:
                size_hint_x: 0.4 