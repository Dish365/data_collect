#:import dp kivy.metrics.dp

<ProjectsScreen>:
    name: "projects"
    md_bg_color: app.theme_cls.backgroundColor

    MDBoxLayout:
        orientation: "vertical"
        spacing: dp(12)
        md_bg_color: app.theme_cls.backgroundColor

        # Modern TopBar with enhanced styling
        TopBar:
            id: top_bar
            size_hint_y: None
            height: dp(64)

        # Main content layout with modern design
        MDBoxLayout:
            orientation: "vertical"
            id: content_layout
            padding: [dp(20), dp(16), dp(20), dp(20)]
            spacing: dp(24)

            # Enhanced Header Section with modern cards
            MDCard:
                orientation: "vertical"
                adaptive_height: True
                size_hint_y: None
                height: self.minimum_height
                padding: [dp(24), dp(20), dp(24), dp(20)]
                spacing: dp(20)
                elevation: 2
                radius: dp(20)
                style: "elevated"
                md_bg_color: app.theme_cls.surfaceContainerColor

                # Title and Navigation Row
                MDBoxLayout:
                    orientation: "horizontal"
                    adaptive_height: True
                    size_hint_y: None
                    height: dp(56)
                    spacing: dp(16)

                    # Left Section: Back arrow + Title
                    MDBoxLayout:
                        orientation: "horizontal"
                        adaptive_width: True
                        size_hint_x: None
                        width: self.minimum_width
                        spacing: dp(12)
                        pos_hint: {"center_y": 0.5}

                        MDIconButton:
                            icon: "arrow-left"
                            size_hint: None, None
                            size: dp(48), dp(48)
                            theme_icon_color: "Primary"
                            pos_hint: {"center_y": 0.5}
                            on_release:
                                root.manager.transition.direction = "right"
                                root.manager.current = "dashboard"

                        MDLabel:
                            text: "Projects"
                            font_style: "Headline"
                            role: "large"
                            theme_text_color: "Primary"
                            pos_hint: {"center_y": 0.5}
                            adaptive_width: True
                            size_hint_x: None
                            width: self.texture_size[0]

                    Widget:  # Spacer

                    # Right Section: Action buttons
                    MDBoxLayout:
                        orientation: "horizontal"
                        adaptive_width: True
                        size_hint_x: None
                        width: self.minimum_width
                        spacing: dp(12)
                        pos_hint: {"center_y": 0.5}

                        MDButton:
                            style: "filled"
                            size_hint: None, None
                            size: dp(160), dp(52)
                            on_release: root.navigate_to_project_creation()
                            md_bg_color: app.theme_cls.primaryColor
                            elevation: 3
                            radius: [dp(26)]

                            MDButtonIcon:
                                icon: "plus"

                            MDButtonText:
                                text: "New Project"
                                font_style: "Label"
                                role: "large"

                        MDIconButton:
                            icon: "refresh"
                            size_hint: None, None
                            size: dp(52), dp(52)
                            theme_icon_color: "Primary"
                            pos_hint: {"center_y": 0.5}
                            on_release: root.check_and_sync_projects()
                            style: "filled"
                            md_bg_color: app.theme_cls.surfaceContainerHighColor

                # Search Section
                MDTextField:
                    id: search_field
                    mode: "outlined"
                    size_hint_y: None
                    height: dp(60)
                    on_text: root.search_projects(self.text)
                    radius: [dp(30)]

                    MDTextFieldHintText:
                        text: "Search projects by name or description..."

                    MDTextFieldLeadingIcon:
                        icon: "magnify"
                        theme_icon_color: "Secondary"

                # Filter and Sort Toolbar
                MDCard:
                    orientation: "vertical"
                    adaptive_height: True
                    size_hint_y: None
                    height: self.minimum_height
                    padding: [dp(24), dp(16), dp(24), dp(16)]
                    spacing: dp(16)
                    elevation: 1
                    radius: dp(16)
                    style: "elevated"
                    md_bg_color: app.theme_cls.surfaceContainerLowColor
                    
                    MDBoxLayout:
                        orientation: "horizontal"
                        adaptive_height: True
                        size_hint_y: None
                        height: dp(48)
                        spacing: dp(16)

                        # Filter section with icon
                        MDBoxLayout:
                            orientation: "horizontal"
                            adaptive_width: True
                            size_hint_x: None
                            width: self.minimum_width
                            spacing: dp(12)
                            pos_hint: {"center_y": 0.5}
                            
                            MDIcon:
                                icon: "filter-variant"
                                size_hint: None, None
                                size: dp(20), dp(20)
                                theme_icon_color: "Primary"
                                pos_hint: {"center_y": 0.5}
                            
                            MDLabel:
                                text: "Filter:"
                                font_style: "Label"
                                role: "large"
                                theme_text_color: "Primary"
                                adaptive_width: True
                                size_hint_x: None
                                width: self.texture_size[0]
                                pos_hint: {"center_y": 0.5}

                        # Filter buttons container
                        MDBoxLayout:
                            orientation: "horizontal"
                            adaptive_width: True
                            size_hint_x: None
                            width: self.minimum_width
                            spacing: dp(8)
                            pos_hint: {"center_y": 0.5}

                            MDButton:
                                id: filter_all_btn
                                style: "filled"
                                size_hint_x: None
                                width: dp(72)
                                size_hint_y: None
                                height: dp(36)
                                on_release: root.filter_projects("all")
                                md_bg_color: app.theme_cls.primaryColor
                                radius: [dp(18)]

                                MDButtonText:
                                    text: "All"
                                    font_style: "Label"
                                    role: "medium"

                            MDButton:
                                id: filter_recent_btn
                                style: "outlined"
                                size_hint_x: None
                                width: dp(80)
                                size_hint_y: None
                                height: dp(36)
                                on_release: root.filter_projects("recent")
                                line_color: app.theme_cls.outlineColor
                                radius: [dp(18)]

                                MDButtonText:
                                    text: "Recent"
                                    font_style: "Label"
                                    role: "medium"

                            MDButton:
                                id: filter_synced_btn
                                style: "outlined"
                                size_hint_x: None
                                width: dp(80)
                                size_hint_y: None
                                height: dp(36)
                                on_release: root.filter_projects("synced")
                                line_color: app.theme_cls.outlineColor
                                radius: [dp(18)]

                                MDButtonText:
                                    text: "Synced"
                                    font_style: "Label"
                                    role: "medium"

                            MDButton:
                                id: filter_pending_btn
                                style: "outlined"
                                size_hint_x: None
                                width: dp(84)
                                size_hint_y: None
                                height: dp(36)
                                on_release: root.filter_projects("pending")
                                line_color: app.theme_cls.outlineColor
                                radius: [dp(18)]

                                MDButtonText:
                                    text: "Pending"
                                    font_style: "Label"
                                    role: "medium"

                        Widget:  # Spacer

                        # Sort and View Controls
                        MDBoxLayout:
                            orientation: "horizontal"
                            adaptive_width: True
                            size_hint_x: None
                            width: self.minimum_width
                            spacing: dp(8)
                            pos_hint: {"center_y": 0.5}

                            MDIconButton:
                                id: sort_btn
                                icon: "sort"
                                size_hint: None, None
                                size: dp(40), dp(40)
                                theme_icon_color: "Primary"
                                on_release: root.show_sort_menu()
                                style: "standard"

                            MDIconButton:
                                id: view_toggle_btn
                                icon: "view-grid"
                                size_hint: None, None
                                size: dp(40), dp(40)
                                theme_icon_color: "Primary"
                                on_release: root.toggle_view_mode()
                                style: "standard"

            # Projects Grid Container with modern scrolling
            MDCard:
                orientation: "vertical"
                size_hint_y: 1  # Take full available height
                padding: [dp(24), dp(20)]
                elevation: 2
                radius: dp(20)
                style: "elevated"
                md_bg_color: app.theme_cls.surfaceContainerColor

                MDScrollView:
                    size_hint: 1, 1
                    do_scroll_x: False
                    bar_width: dp(6)

                    MDGridLayout:
                        id: projects_grid
                        cols: 1  # Will be dynamically adjusted
                        spacing: dp(16)
                        adaptive_height: True
                        size_hint_y: None
                        height: self.minimum_height
                        padding: [dp(8), dp(8), dp(8), dp(8)]