<FormBuilderScreen>:
    MDBoxLayout:
        orientation: 'vertical'

        # Top bar
        TopBar:
            id: top_bar
            left_action_items: [["arrow-left", lambda x: setattr(root.manager, 'current', 'dashboard')]]
            right_action_items: [["content-save", lambda x: root.save_form()]]

        # Title row
        MDBoxLayout:
            orientation: 'horizontal'
            padding: [dp(16), dp(10)]
            size_hint_y: None
            height: dp(56)
            spacing: dp(10)

            MDIconButton:
                icon: "arrow-left"
                on_release: setattr(root.manager, 'current', 'dashboard')

            MDLabel:
                text: "Form Builder"
                font_style: "H6"
                halign: "left"
                size_hint_x: None
                width: dp(160)

            Widget:

            MDLabel:
                text: "Select Project"
                size_hint_x: None
                width: dp(110)
                font_style: "Subtitle2"
                halign: "right"

            MDDropDownItem:
                id: project_spinner
                text: 'Select Project'
                on_release: root.open_project_menu()
                pos_hint: {'center_y': 0.5}
                md_bg_color: app.theme_cls.primary_light
                radius: [12, 12, 12, 12]
                font_size: '16sp'
                size_hint_x: None
                width: dp(160)

        # Main content area
        MDBoxLayout:
            orientation: 'horizontal'
            spacing: dp(16)
            padding: dp(16)

            # Left panel - Question Types
            MDBoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.3

                MDCard:
                    orientation: 'vertical'
                    size_hint_y: 1
                    padding: dp(16)
                    spacing: dp(12)
                    radius: [16, 16, 16, 16]
                    elevation: 2
                    md_bg_color: app.theme_cls.bg_light

                    MDLabel:
                        text: "Question Types"
                        font_style: "H6"
                        size_hint_y: None
                        height: self.texture_size[1]

                    MDScrollView:
                        MDBoxLayout:
                            orientation: 'vertical'
                            padding: [0, dp(4)]
                            spacing: dp(10)
                            size_hint_y: None
                            height: self.minimum_height

                            # Text Response Types
                            MDLabel:
                                text: "Text Responses"
                                font_style: "Subtitle2"
                                theme_text_color: "Primary"
                                size_hint_y: None
                                height: dp(30)

                            MDRaisedButton:
                                text: "Short Text"
                                on_release: root.add_question('text_short')
                                size_hint_y: None
                                height: dp(40)
                                md_bg_color: app.theme_cls.primary_color
                                text_color: 1, 1, 1, 1

                            MDRaisedButton:
                                text: "Long Text"
                                on_release: root.add_question('text_long')
                                size_hint_y: None
                                height: dp(40)
                                md_bg_color: app.theme_cls.primary_color
                                text_color: 1, 1, 1, 1

                            # Numeric Response Types
                            MDLabel:
                                text: "Numeric Responses"
                                font_style: "Subtitle2"
                                theme_text_color: "Primary"
                                size_hint_y: None
                                height: dp(30)

                            MDRaisedButton:
                                text: "Number (Integer)"
                                on_release: root.add_question('numeric_integer')
                                size_hint_y: None
                                height: dp(40)
                                md_bg_color: app.theme_cls.accent_color
                                text_color: 1, 1, 1, 1

                            MDRaisedButton:
                                text: "Number (Decimal)"
                                on_release: root.add_question('numeric_decimal')
                                size_hint_y: None
                                height: dp(40)
                                md_bg_color: app.theme_cls.accent_color
                                text_color: 1, 1, 1, 1

                            MDRaisedButton:
                                text: "Rating Scale"
                                on_release: root.add_question('scale_rating')
                                size_hint_y: None
                                height: dp(40)
                                md_bg_color: app.theme_cls.accent_color
                                text_color: 1, 1, 1, 1

                            # Choice Response Types
                            MDLabel:
                                text: "Choice Responses"
                                font_style: "Subtitle2"
                                theme_text_color: "Primary"
                                size_hint_y: None
                                height: dp(30)

                            MDRaisedButton:
                                text: "Single Choice"
                                on_release: root.add_question('choice_single')
                                size_hint_y: None
                                height: dp(40)
                                md_bg_color: 0.8, 0.4, 0.2, 1
                                text_color: 1, 1, 1, 1

                            MDRaisedButton:
                                text: "Multiple Choice"
                                on_release: root.add_question('choice_multiple')
                                size_hint_y: None
                                height: dp(40)
                                md_bg_color: 0.8, 0.4, 0.2, 1
                                text_color: 1, 1, 1, 1

                            # Date & Time Response Types
                            MDLabel:
                                text: "Date & Time"
                                font_style: "Subtitle2"
                                theme_text_color: "Primary"
                                size_hint_y: None
                                height: dp(30)

                            MDRaisedButton:
                                text: "Date"
                                on_release: root.add_question('date')
                                size_hint_y: None
                                height: dp(40)
                                md_bg_color: 0.2, 0.6, 0.4, 1
                                text_color: 1, 1, 1, 1

                            MDRaisedButton:
                                text: "Date & Time"
                                on_release: root.add_question('datetime')
                                size_hint_y: None
                                height: dp(40)
                                md_bg_color: 0.2, 0.6, 0.4, 1
                                text_color: 1, 1, 1, 1

                            # Location Response Types
                            MDLabel:
                                text: "Location"
                                font_style: "Subtitle2"
                                theme_text_color: "Primary"
                                size_hint_y: None
                                height: dp(30)

                            MDRaisedButton:
                                text: "GPS Location"
                                on_release: root.add_question('geopoint')
                                size_hint_y: None
                                height: dp(40)
                                md_bg_color: 0.6, 0.2, 0.6, 1
                                text_color: 1, 1, 1, 1

                            # Media Response Types
                            MDLabel:
                                text: "Media & Files"
                                font_style: "Subtitle2"
                                theme_text_color: "Primary"
                                size_hint_y: None
                                height: dp(30)

                            MDRaisedButton:
                                text: "Photo/Image"
                                on_release: root.add_question('image')
                                size_hint_y: None
                                height: dp(40)
                                md_bg_color: 0.4, 0.6, 0.8, 1
                                text_color: 1, 1, 1, 1

                            MDRaisedButton:
                                text: "Audio Recording"
                                on_release: root.add_question('audio')
                                size_hint_y: None
                                height: dp(40)
                                md_bg_color: 0.4, 0.6, 0.8, 1
                                text_color: 1, 1, 1, 1

                            # Special Response Types
                            MDLabel:
                                text: "Special"
                                font_style: "Subtitle2"
                                theme_text_color: "Primary"
                                size_hint_y: None
                                height: dp(30)

                            MDRaisedButton:
                                text: "Barcode/QR Code"
                                on_release: root.add_question('barcode')
                                size_hint_y: None
                                height: dp(40)
                                md_bg_color: 0.3, 0.3, 0.3, 1
                                text_color: 1, 1, 1, 1

            # Right panel - Form Canvas
            MDBoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.7
                spacing: dp(10)

                MDScrollView:
                    MDBoxLayout:
                        id: form_canvas
                        orientation: 'vertical'
                        spacing: dp(12)
                        adaptive_height: True
                        padding: dp(10)

        # Fixed footer bar
        MDBoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(64)
            padding: [dp(24), dp(10)]
            spacing: dp(16)
            md_bg_color: 0.96, 0.96, 0.96, 1  # Light gray footer background

            Widget:

            MDRaisedButton:
                text: "Save"
                md_bg_color: 0.2, 0.4, 0.8, 1  # Custom blue
                text_color: 1, 1, 1, 1
                elevation: 3
                on_release: root.save_form()

            MDRaisedButton:
                text: "Preview Questions"
                md_bg_color: 0.5, 0.3, 0.6, 1  # Purple shade
                text_color: 1, 1, 1, 1
                elevation: 3
                on_release: root.preview_questions()

            Widget:

        # Optional spinner for loading
        MDSpinner:
            id: spinner
            size_hint: None, None
            size: dp(46), dp(46)
            pos_hint: {'center_x': .5, 'center_y': .5}
            active: False
