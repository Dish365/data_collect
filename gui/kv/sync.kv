<SyncScreen>:
    name: "sync"
    md_bg_color: app.theme_cls.backgroundColor

    # Use FloatLayout for proper overlay support
    FloatLayout:
        size_hint: 1, 1
        
        # Main content
        MDBoxLayout:
            orientation: 'vertical'
            size_hint: 1, 1
            pos_hint: {'x': 0, 'y': 0}
            md_bg_color: app.theme_cls.backgroundColor

            # Top Bar
            TopBar:
                id: top_bar

            # Main content area with refresh support
            MDScrollViewRefreshLayout:
                id: refresh_layout
                refresh_callback: root.on_refresh
                root_layout: root
                size_hint: 1, 1
            
                ScrollView:
                    id: main_scroll_view
                    size_hint: 1, 1
                    
                    MDBoxLayout:
                        id: content_layout
                        orientation: 'vertical'
                        padding: dp(20)
                        spacing: dp(20)
                        adaptive_height: True
                        size_hint_y: None
                        height: self.minimum_height

                        # Header Card
                        MDCard:
                            style: "elevated"
                            size_hint_y: None
                            height: dp(140)
                            md_bg_color: app.theme_cls.surfaceVariantColor
                            
                            MDBoxLayout:
                                orientation: 'vertical'
                                padding: dp(20)
                                spacing: dp(12)
                                
                                MDLabel:
                                    text: "Data Synchronization"
                                    font_style: "Headline"
                                    role: "small"
                                    halign: "left"
                                    size_hint_y: None
                                    height: self.texture_size[1]
                                    
                                MDLabel:
                                    id: sync_description
                                    text: "Keep your local data synchronized with the server"
                                    font_style: "Body"
                                    role: "large"
                                    theme_text_color: "Hint"
                                    halign: "left"
                                    size_hint_y: None
                                    height: self.texture_size[1]

                        # Status Card
                        MDCard:
                            style: "elevated"
                            size_hint_y: None
                            height: dp(120)
                            
                            MDBoxLayout:
                                orientation: 'horizontal'
                                padding: dp(20)
                                spacing: dp(16)
                                
                                # Stats Column
                                MDBoxLayout:
                                    orientation: 'vertical'
                                    size_hint_x: 0.6
                                    spacing: dp(8)
                                    
                                    MDBoxLayout:
                                        orientation: 'horizontal'
                                        size_hint_y: None
                                        height: dp(24)
                                        spacing: dp(8)
                                        
                                        MDIcon:
                                            icon: "database-sync"
                                            size_hint_x: None
                                            width: dp(24)
                                            theme_icon_color: "Primary"
                                            
                                        MDLabel:
                                            id: total_items_label
                                            text: "0 pending items"
                                            font_style: "Body"
                                            role: "large"
                                            halign: "left"
                                            
                                    MDBoxLayout:
                                        orientation: 'horizontal'
                                        size_hint_y: None
                                        height: dp(24)
                                        spacing: dp(8)
                                        
                                        MDIcon:
                                            id: status_icon
                                            icon: "check-circle"
                                            size_hint_x: None
                                            width: dp(24)
                                            theme_icon_color: "Primary"
                                            
                                        MDLabel:
                                            id: sync_status_label
                                            text: "Ready to sync"
                                            font_style: "Body"
                                            role: "large"
                                            halign: "left"
                                
                                # Action Column
                                MDBoxLayout:
                                    orientation: 'vertical'
                                    size_hint_x: 0.4
                                    spacing: dp(8)
                                    
                                    MDButton:
                                        id: sync_all_button
                                        style: "filled"
                                        size_hint_y: None
                                        height: dp(40)
                                        on_release: root.sync_all_items()
                                        disabled: False
                                        
                                        MDButtonText:
                                            text: "Sync All"
                                            
                                    MDButton:
                                        id: refresh_button
                                        style: "outlined"
                                        size_hint_y: None
                                        height: dp(40)
                                        on_release: root.refresh_pending_items()
                                        
                                        MDButtonText:
                                            text: "Refresh"

                        # Progress Card (only visible during sync)
                        MDCard:
                            id: progress_card
                            style: "elevated"
                            size_hint_y: None
                            height: dp(80)
                            opacity: 0
                            
                            MDBoxLayout:
                                orientation: 'vertical'
                                padding: dp(20)
                                spacing: dp(12)
                                
                                MDLabel:
                                    id: progress_label
                                    text: "Synchronizing..."
                                    font_style: "Body"
                                    role: "large"
                                    halign: "left"
                                    size_hint_y: None
                                    height: self.texture_size[1]
                                    
                                MDLinearProgressIndicator:
                                    id: sync_progress
                                    value: 0
                                    size_hint_y: None
                                    height: dp(6)

                        # Filter and Sort
                        MDCard:
                            id: filter_card
                            style: "outlined"
                            size_hint_y: None
                            height: dp(60)
                            
                            MDBoxLayout:
                                orientation: 'horizontal'
                                padding: dp(16)
                                spacing: dp(12)
                                
                                MDIcon:
                                    icon: "filter-variant"
                                    size_hint_x: None
                                    width: dp(24)
                                    theme_icon_color: "Primary"
                                    
                                MDLabel:
                                    text: "Sync Queue Items"
                                    font_style: "Title"
                                    role: "medium"
                                    halign: "left"
                                    
                                Widget:
                                    # Spacer
                                    
                                MDIconButton:
                                    id: sort_button
                                    icon: "sort-ascending"
                                    on_release: root.toggle_sort()

                        # Items List
                        MDBoxLayout:
                            id: pending_items_layout
                            orientation: "vertical"
                            spacing: dp(8)
                            adaptive_height: True

                        # Empty State
                        MDCard:
                            id: empty_state_card
                            style: "outlined"
                            size_hint_y: None
                            height: dp(160)
                            opacity: 1
                            md_bg_color: app.theme_cls.surfaceColor
                            
                            MDBoxLayout:
                                orientation: 'vertical'
                                padding: dp(20)
                                spacing: dp(12)
                                
                                MDIcon:
                                    icon: "check-all"
                                    size_hint: None, None
                                    size: dp(48), dp(48)
                                    pos_hint: {'center_x': 0.5}
                                    theme_icon_color: "Primary"
                                    
                                MDLabel:
                                    text: "All Synchronized!"
                                    font_style: "Headline"
                                    role: "small"
                                    halign: "center"
                                    size_hint_y: None
                                    height: self.texture_size[1]
                                    
                                MDLabel:
                                    text: "No pending items to sync"
                                    font_style: "Body"
                                    role: "medium"
                                    theme_text_color: "Hint"
                                    halign: "center"
                                    size_hint_y: None
                                    height: self.texture_size[1]

        # Loading Overlay (positioned as overlay within FloatLayout)
        MDBoxLayout:
            id: loading_overlay
            orientation: 'vertical'
            size_hint: 1, 1
            pos_hint: {'x': 0, 'y': 0}
            opacity: 0
            md_bg_color: [0, 0, 0, 0.5]
            
            Widget:
                # Top spacer
                
            MDCard:
                style: "elevated"
                size_hint: None, None
                size: dp(120), dp(120)
                pos_hint: {'center_x': 0.5}
                
                MDBoxLayout:
                    orientation: 'vertical'
                    padding: dp(20)
                    spacing: dp(12)
                    
                    MDCircularProgressIndicator:
                        id: spinner
                        size_hint: None, None
                        size: dp(40), dp(40)
                        pos_hint: {'center_x': 0.5}
                        active: False
                        
                    MDLabel:
                        text: "Syncing..."
                        font_style: "Body"
                        role: "medium"
                        halign: "center"
                        size_hint_y: None
                        height: self.texture_size[1]
                        
            Widget:
                # Bottom spacer 