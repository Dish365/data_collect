#:import dp kivy.metrics.dp

<DashboardScreen>:
    name: "dashboard"

    MDBoxLayout:
        orientation: 'vertical'
        size_hint: 1, 1

        # Modern Top Bar with enhanced styling
        MDBoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(64)  # Increased for modern Material Design
            md_bg_color: app.theme_cls.primaryColor
            padding: dp(12)
            elevation: 4
            
            TopBar:
                id: top_bar
                
            MDIconButton:
                icon: "refresh"
                theme_icon_color: "Custom"
                icon_color: 1, 1, 1, 0.9
                size_hint: None, None
                size: dp(48), dp(48)
                radius: dp(24)
                pos_hint: {"center_y": 0.5}
                theme_bg_color: "Custom"
                md_bg_color: 1, 1, 1, 0.1
                ripple_scale: 0.85
                on_release: root.refresh_dashboard()

        RelativeLayout:
            size_hint: 1, 1
            
            # Main content area with modern scrolling
            MDScrollView:
                id: main_scroll_view
                size_hint: 1, 1
                do_scroll_x: False
                bar_width: dp(4)
                
                MDBoxLayout:
                    id: content_layout
                    orientation: 'vertical'
                    padding: dp(24)
                    spacing: dp(24)  # Increased for better visual hierarchy
                    adaptive_height: True
                    size_hint_y: None
                    height: self.minimum_height

                    # Modern page title with better typography
                    MDLabel:
                        text: "Research Dashboard"
                        theme_font_size: "Custom"
                        font_size: dp(32)
                        bold: True
                        size_hint_y: None
                        height: self.texture_size[1] + dp(16)
                        halign: "left"
                        theme_text_color: "Primary"

                    # Stats section with modern card design
                    MDLabel:
                        text: "Overview"
                        theme_font_size: "Custom"
                        font_size: dp(18)
                        bold: True
                        halign: "left"
                        size_hint_y: None
                        height: self.texture_size[1] + dp(12)
                        theme_text_color: "Secondary"

                    # Responsive Stats Grid
                    MDBoxLayout:
                        id: stats_container
                        orientation: 'vertical'
                        adaptive_height: True
                        size_hint_y: None
                        height: self.minimum_height
                        spacing: dp(16)
                        
                        MDGridLayout:
                            id: stats_grid
                            adaptive_height: True
                            size_hint_y: None
                            height: self.minimum_height
                            spacing: dp(16)
                            cols: 1  # Will be updated by Python code

                            StatCard:
                                id: total_responses_card
                                title: "Total Respondents"
                                value: "Loading..."
                                icon: "database"
                                size_hint_y: None
                                size_hint_x: 1
                                on_press: root.navigate_to("responses")

                            StatCard:
                                id: active_projects_card
                                title: "Active Projects"
                                value: "Loading..."
                                icon: "folder"
                                size_hint_y: None
                                size_hint_x: 1
                                on_press: root.navigate_to("projects")

                            StatCard:
                                id: pending_sync_card
                                title: "Pending Sync"
                                value: "Loading..."
                                icon: "sync"
                                size_hint_y: None
                                size_hint_x: 1
                                on_press: root.navigate_to("sync")

                            StatCard:
                                id: team_members_card
                                title: "Team Members"
                                value: "Loading..."
                                note: "Click to manage team members"
                                icon: "account-group"
                                size_hint_y: None
                                size_hint_x: 1
                                on_press: root.open_team_management()

                    # Quick Actions section
                    MDLabel:
                        text: "Quick Actions"
                        theme_font_size: "Custom"
                        font_size: dp(18)
                        bold: True
                        halign: "left"
                        size_hint_y: None
                        height: self.texture_size[1] + dp(12)
                        theme_text_color: "Secondary"

                    # Modern action buttons grid
                    MDBoxLayout:
                        id: actions_container
                        orientation: 'vertical'
                        adaptive_height: True
                        size_hint_y: None
                        height: self.minimum_height
                        spacing: dp(16)
                        
                        MDGridLayout:
                            id: actions_grid
                            adaptive_height: True
                            size_hint_y: None
                            height: self.minimum_height
                            spacing: dp(16)
                            cols: 2  # Will be updated by Python code
                            row_default_height: dp(64)  # Increased for better touch targets
                            row_force_default: True
                            size_hint_x: 1
                            
                            MDButton:
                                style: "filled"
                                size_hint: 1, None
                                height: dp(64)
                                on_release: root.navigate_to("projects")
                                
                                MDButtonText:
                                    text: "Projects"
                                    theme_font_size: "Custom"
                                    font_size: dp(16)

                            MDButton:
                                style: "filled"
                                size_hint: 1, None
                                height: dp(64)
                                on_release: root.navigate_to("data_collection")
                                
                                MDButtonText:
                                    text: "Collect Data"
                                    theme_font_size: "Custom"
                                    font_size: dp(16)

                            MDButton:
                                style: "filled"
                                size_hint: 1, None
                                height: dp(64)
                                on_release: root.navigate_to("analytics")
                                
                                MDButtonText:
                                    text: "Analytics"
                                    theme_font_size: "Custom"
                                    font_size: dp(16)

                            MDButton:
                                style: "filled"
                                size_hint: 1, None
                                height: dp(64)
                                on_release: root.navigate_to("data_exploration")
                                
                                MDButtonText:
                                    text: "Data Exploration"
                                    theme_font_size: "Custom"
                                    font_size: dp(16)

                            MDButton:
                                style: "filled"
                                size_hint: 1, None
                                height: dp(64)
                                on_release: root.navigate_to("qualitative_analytics")
                                
                                MDButtonText:
                                    text: "Qualitative Analytics"
                                    theme_font_size: "Custom"
                                    font_size: dp(16)

                            MDButton:
                                style: "filled"
                                size_hint: 1, None
                                height: dp(64)
                                on_release: root.navigate_to("form_builder")
                                
                                MDButtonText:
                                    text: "Form Builder"
                                    theme_font_size: "Custom"
                                    font_size: dp(16)

                            MDButton:
                                style: "filled"
                                size_hint: 1, None
                                height: dp(64)
                                on_release: root.open_team_management()
                                
                                MDButtonText:
                                    text: "Team Members"
                                    theme_font_size: "Custom"
                                    font_size: dp(16)

                            MDButton:
                                style: "filled"
                                size_hint: 1, None
                                height: dp(64)
                                on_release: root.navigate_to("sync")
                                
                                MDButtonText:
                                    text: "Sync Status"
                                    theme_font_size: "Custom"
                                    font_size: dp(16)

                    # Recent Activity section
                    MDLabel:
                        text: "Recent Activity"
                        theme_font_size: "Custom"
                        font_size: dp(18)
                        bold: True
                        halign: "left"
                        size_hint_y: None
                        height: self.texture_size[1] + dp(12)
                        theme_text_color: "Secondary"

                    # Modern activity feed with card container
                    MDCard:
                        orientation: "vertical"
                        adaptive_height: True
                        size_hint_y: None
                        height: self.minimum_height
                        radius: dp(16)
                        elevation: 2
                        padding: dp(16)
                        md_bg_color: app.theme_cls.surfaceContainerColor

                        MDBoxLayout:
                            id: activity_feed_layout
                            orientation: "vertical"
                            spacing: dp(12)
                            adaptive_height: True
                            size_hint_y: None
                            height: self.minimum_height

            # Modern loading indicator
            MDCard:
                id: loading_card
                size_hint: None, None
                size: dp(120), dp(120)
                radius: dp(16)
                elevation: 8
                pos_hint: {'center_x': .5, 'center_y': .5}
                md_bg_color: app.theme_cls.surfaceContainerHighColor
                opacity: 0
                
                MDBoxLayout:
                    orientation: "vertical"
                    spacing: dp(16)
                    pos_hint: {'center_x': .5, 'center_y': .5}
                    adaptive_height: True
                    
                    MDCircularProgressIndicator:
                        id: spinner
                        size_hint: None, None
                        size: dp(48), dp(48)
                        pos_hint: {'center_x': .5}
                        active: False
                    
                    MDLabel:
                        text: "Loading..."
                        theme_font_size: "Custom"
                        font_size: dp(14)
                        halign: "center"
                        theme_text_color: "Secondary"
                        size_hint_y: None
                        height: self.texture_size[1]