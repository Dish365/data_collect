<DashboardScreen>:
    name: "dashboard"

    MDBoxLayout:
        orientation: 'vertical'

        # Responsive Top Bar with refresh button
        MDBoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(56)
            
            TopBar:
                id: top_bar
                
            MDIconButton:
                icon: "refresh"
                theme_icon_color: "Primary"
                size_hint_x: None
                width: dp(48)
                on_press: root.refresh_dashboard()

        RelativeLayout:
            # Main content area
            ScrollView:
                id: main_scroll_view
                MDBoxLayout:
                    id: content_layout
                    orientation: 'vertical'
                    padding: dp(16)
                    spacing: dp(16)
                    adaptive_height: True

                    MDLabel:
                        text: "Research Dashboard"
                        font_style: "H5"
                        size_hint_y: None
                        height: self.texture_size[1] + dp(10)
                        halign: "left"

                    MDGridLayout:
                        id: stats_grid
                        cols: 2
                        adaptive_height: True
                        spacing: dp(12)

                        StatCard:
                            id: total_responses_card
                            title: "Total Respondents"
                            icon: "database"
                            on_press: root.navigate_to("responses")

                        StatCard:
                            id: active_projects_card
                            title: "Active Projects"
                            icon: "folder"
                            on_press: root.navigate_to("projects")

                        StatCard:
                            id: pending_sync_card
                            title: "Pending Sync"
                            icon: "sync"
                            on_press: root.navigate_to("sync")

                        StatCard:
                            id: team_members_card
                            title: "Team Members"
                            icon: "account-group"

                    MDLabel:
                        text: "Quick Actions"
                        font_style: "Subtitle1"
                        halign: "left"
                        size_hint_y: None
                        height: self.texture_size[1] + dp(10)

                    MDGridLayout:
                        cols: 2
                        spacing: dp(10)
                        adaptive_height: True

                        MDRaisedButton:
                            text: "Projects"
                            on_press: root.navigate_to("projects")

                        MDRaisedButton:
                            text: "Collect Data"
                            on_press: root.navigate_to("data_collection")

                        MDRaisedButton:
                            text: "Analytics"
                            on_press: root.navigate_to("analytics")

                        MDRaisedButton:
                            text: "Form Builder"
                            on_press: root.navigate_to("form_builder")

                    MDLabel:
                        text: "Recent Activity"
                        font_style: "Subtitle1"
                        halign: "left"
                        size_hint_y: None
                        height: self.texture_size[1] + dp(10)

                    MDBoxLayout:
                        id: activity_feed_layout
                        orientation: "vertical"
                        spacing: dp(8)
                        adaptive_height: True

            # Loading spinner
            MDSpinner:
                id: spinner
                size_hint: None, None
                size: dp(46), dp(46)
                pos_hint: {'center_x': .5, 'center_y': .5}
                active: False
