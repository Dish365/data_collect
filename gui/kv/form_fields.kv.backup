#:kivy 2.0
#:import MDCard kivymd.uix.card.MDCard
#:import MDBoxLayout kivymd.uix.boxlayout.MDBoxLayout
#:import MDTextField kivymd.uix.textfield.MDTextField
#:import MDButton kivymd.uix.button.MDButton
#:import MDButtonText kivymd.uix.button.MDButtonText
#:import MDButtonIcon kivymd.uix.button.MDButtonIcon
#:import MDIconButton kivymd.uix.button.MDIconButton
#:import MDLabel kivymd.uix.label.MDLabel
#:import MDCheckbox kivymd.uix.selectioncontrol.MDCheckbox
#:import MDSlider kivymd.uix.slider.MDSlider
#:import ScrollView kivy.uix.scrollview.ScrollView
#:import GridLayout kivy.uix.gridlayout.GridLayout

# Modern Base Form Field Component
<BaseFormField>:
    orientation: 'vertical'
    size_hint_y: None
    height: dp(240)
    elevation: 2
    md_bg_color: 1, 1, 1, 1
    radius: [12, 12, 12, 12]
    padding: [dp(24), dp(16)]
    spacing: dp(16)
    
    # Header Section
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(12)
        size_hint_y: None
        height: dp(32)
        
        MDIconButton:
            icon: "help-circle-outline"
            size_hint: None, None
            size: dp(24), dp(24)
            theme_icon_color: "Primary"
            disabled: True
            style: "standard"
        
        MDLabel:
            text: f"Question {root.question_number}"
            font_style: "Subtitle1"
            theme_text_color: "Primary"
            bold: True
        
        MDLabel:
            text: f"({root.response_type.replace('_', ' ').title()})"
            font_style: "Caption"
            theme_text_color: "Secondary"
            size_hint_x: None
            width: dp(120)
        
        Widget:
            size_hint_x: 1
        
        ModernDeleteButton:
            on_release: root.parent.remove_widget(root) if root.parent else None

# Modern Delete Button Component
<ModernDeleteButton@MDButton>:
    style: "filled"
    md_bg_color: 0.9, 0.2, 0.2, 1
    size_hint: None, None
    size: dp(120), dp(36)
    
    MDButtonIcon:
        icon: "delete"
    
    MDButtonText:
        text: "Delete"
        font_size: "12sp"

# Modern Action Button Component  
<ModernActionButton@MDButton>:
    button_text: "Action"
    button_icon: "plus"
    button_style: "filled"
    button_color: 0.2, 0.6, 1.0, 1
    
    style: root.button_style
    md_bg_color: root.button_color
    size_hint: None, None
    size: dp(100), dp(36)
    
    MDButtonIcon:
        icon: root.button_icon
    
    MDButtonText:
        text: root.button_text
        font_size: "12sp"

# Short Text Field Component
<ShortTextField>:
    
    # Question Input Field
    MDTextField:
        id: question_input
        hint_text: "Enter your short text question here..."
        text: root.question_text
        mode: "outlined"
        size_hint_y: None
        height: dp(56)
        on_text: root.question_text = self.text
    
    # Preview Field
    MDTextField:
        hint_text: "Short answer preview"
        mode: "outlined"
        size_hint_y: None
        height: dp(48)
        disabled: True
        helper_text: "Respondents will type their answer here"
        helper_text_mode: "on_focus"

# Long Text Field Component
<LongTextField>:
    
    # Question Input Field
    MDTextField:
        id: question_input
        hint_text: "Enter your long text question here..."
        text: root.question_text
        mode: "outlined"
        size_hint_y: None
        height: dp(56)
        on_text: root.question_text = self.text
    
    # Preview Field
    MDTextField:
        hint_text: "Long answer preview"
        multiline: True
        mode: "outlined"
        size_hint_y: None
        height: dp(80)
        disabled: True
        helper_text: "Respondents will type a detailed answer here"
        helper_text_mode: "on_focus"

# Numeric Integer Field Component
<NumericIntegerField>:
    
    # Question Input Field
    MDTextField:
        id: question_input
        hint_text: "Enter your numeric question here..."
        text: root.question_text
        mode: "outlined"
        size_hint_y: None
        height: dp(56)
        on_text: root.question_text = self.text
    
    # Preview Field
    MDTextField:
        hint_text: "123"
        mode: "outlined"
        input_filter: "int"
        size_hint_y: None
        height: dp(48)
        disabled: True
        helper_text: "Respondents will enter a whole number"
        helper_text_mode: "on_focus"

# Numeric Decimal Field Component
<NumericDecimalField>:
    
    # Question Input Field
    MDTextField:
        id: question_input
        hint_text: "Enter your decimal number question here..."
        text: root.question_text
        mode: "outlined"
        size_hint_y: None
        height: dp(56)
        on_text: root.question_text = self.text
    
    # Preview Field
    MDTextField:
        hint_text: "123.45"
        mode: "outlined"
        input_filter: "float"
        size_hint_y: None
        height: dp(48)
        disabled: True
        helper_text: "Respondents will enter a decimal number"
        helper_text_mode: "on_focus"

# Single Choice Field Component
<SingleChoiceField>:
    options: []
    
    # Question Input Field
    MDTextField:
        id: question_input
        hint_text: "Enter your single choice question here..."
        text: root.question_text
        mode: "outlined"
        size_hint_y: None
        height: dp(56)
        on_text: root.question_text = self.text
    
    # Options Management
    MDBoxLayout:
        orientation: 'vertical'
        spacing: dp(8)
        size_hint_y: None
        adaptive_height: True
        
        MDLabel:
            text: "Answer Options:"
            font_style: "Body2"
            theme_text_color: "Primary"
            size_hint_y: None
            height: dp(24)
        
        ScrollView:
            id: options_scroll
            size_hint_y: None
            height: dp(100)
            do_scroll_x: False
            
            MDBoxLayout:
                id: options_container
                orientation: 'vertical'
                spacing: dp(4)
                size_hint_y: None
                adaptive_height: True
        
        MDBoxLayout:
            orientation: 'horizontal'
            spacing: dp(8)
            size_hint_y: None
            height: dp(36)
            
            ModernActionButton:
                button_text: "Add Option"
                button_icon: "plus"
                button_color: 0.2, 0.8, 0.2, 1
                on_release: root.add_option()
            
            ModernActionButton:
                button_text: "Remove"
                button_icon: "minus"
                button_color: 0.8, 0.4, 0.2, 1
                on_release: root.remove_option()

# Multiple Choice Field Component
<MultipleChoiceField>:
    options: []
    
    # Question Input Field
    MDTextField:
        id: question_input
        hint_text: "Enter your multiple choice question here..."
        text: root.question_text
        mode: "outlined"
        size_hint_y: None
        height: dp(56)
        on_text: root.question_text = self.text
    
    # Options Management
    MDBoxLayout:
        orientation: 'vertical'
        spacing: dp(8)
        size_hint_y: None
        adaptive_height: True
        
        MDLabel:
            text: "Answer Options (Multiple allowed):"
            font_style: "Body2"
            theme_text_color: "Primary"
            size_hint_y: None
            height: dp(24)
        
        ScrollView:
            id: options_scroll
            size_hint_y: None
            height: dp(100)
            do_scroll_x: False
            
            MDBoxLayout:
                id: options_container
                orientation: 'vertical'
                spacing: dp(4)
                size_hint_y: None
                adaptive_height: True
        
        MDBoxLayout:
            orientation: 'horizontal'
            spacing: dp(8)
            size_hint_y: None
            height: dp(36)
            
            ModernActionButton:
                button_text: "Add Option"
                button_icon: "plus"
                button_color: 0.2, 0.8, 0.2, 1
                on_release: root.add_option()
            
            ModernActionButton:
                button_text: "Remove"
                button_icon: "minus"
                button_color: 0.8, 0.4, 0.2, 1
                on_release: root.remove_option()

# Rating Scale Field Component
<RatingScaleField>:
    
    # Question Input Field
    MDTextField:
        id: question_input
        hint_text: "Enter your rating scale question here..."
        text: root.question_text
        mode: "outlined"
        size_hint_y: None
        height: dp(56)
        on_text: root.question_text = self.text
    
    # Rating Preview
    MDBoxLayout:
        orientation: 'vertical'
        spacing: dp(8)
        size_hint_y: None
        height: dp(80)
        
        MDLabel:
            text: "Rating Scale (1-5):"
            font_style: "Body2"
            theme_text_color: "Primary"
            size_hint_y: None
            height: dp(24)
        
        MDSlider:
            min: 1
            max: 5
            value: 3
            step: 1
            disabled: True
            size_hint_y: None
            height: dp(32)
        
        MDBoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(24)
            
            MDLabel:
                text: "1 (Poor)"
                font_style: "Caption"
                theme_text_color: "Secondary"
                halign: "left"
            
            Widget:
                size_hint_x: 1
            
            MDLabel:
                text: "5 (Excellent)"
                font_style: "Caption"
                theme_text_color: "Secondary"
                halign: "right"

# Date Field Component
<DateField>:
    
    # Question Input Field
    MDTextField:
        id: question_input
        hint_text: "Enter your date question here..."
        text: root.question_text
        mode: "outlined"
        size_hint_y: None
        height: dp(56)
        on_text: root.question_text = self.text
    
    # Date Preview
    MDButton:
        style: "outlined"
        size_hint_y: None
        height: dp(48)
        disabled: True
        
        MDButtonIcon:
            icon: "calendar"
        
        MDButtonText:
            text: "Select Date"
            font_size: "14sp"

# DateTime Field Component
<DateTimeField>:
    
    # Question Input Field
    MDTextField:
        id: question_input
        hint_text: "Enter your date & time question here..."
        text: root.question_text
        mode: "outlined"
        size_hint_y: None
        height: dp(56)
        on_text: root.question_text = self.text
    
    # DateTime Preview
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(8)
        size_hint_y: None
        height: dp(48)
        
        MDButton:
            style: "outlined"
            size_hint_x: 1
            height: dp(48)
            disabled: True
            
            MDButtonIcon:
                icon: "calendar"
            
            MDButtonText:
                text: "Select Date"
                font_size: "14sp"
        
        MDButton:
            style: "outlined"
            size_hint_x: 1
            height: dp(48)
            disabled: True
            
            MDButtonIcon:
                icon: "clock-outline"
            
            MDButtonText:
                text: "Select Time"
                font_size: "14sp"

# Location Picker Field Component
<LocationPickerField>:
    
    # Question Input Field
    MDTextField:
        id: question_input
        hint_text: "Enter your location question here..."
        text: root.question_text
        mode: "outlined"
        size_hint_y: None
        height: dp(56)
        on_text: root.question_text = self.text
    
    # Location Actions
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(8)
        size_hint_y: None
        height: dp(36)
        
        ModernActionButton:
            button_text: "Get Location"
            button_icon: "map-marker"
            button_color: 0.2, 0.6, 0.8, 1
            on_release: root.get_location()
        
        ModernActionButton:
            button_text: "Clear"
            button_icon: "close"
            button_color: 0.8, 0.4, 0.2, 1
            on_release: root.clear_location()

# Photo Upload Field Component
<PhotoUploadField>:
    
    # Question Input Field
    MDTextField:
        id: question_input
        hint_text: "Enter your photo question here..."
        text: root.question_text
        mode: "outlined"
        size_hint_y: None
        height: dp(56)
        on_text: root.question_text = self.text
    
    # Photo Actions
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(8)
        size_hint_y: None
        height: dp(36)
        
        ModernActionButton:
            button_text: "Camera"
            button_icon: "camera"
            button_color: 0.2, 0.6, 0.8, 1
            on_release: root.take_photo()
        
        ModernActionButton:
            button_text: "Gallery"
            button_icon: "image"
            button_color: 0.6, 0.2, 0.8, 1
            on_release: root.choose_photo()
        
        ModernActionButton:
            button_text: "Clear"
            button_icon: "close"
            button_color: 0.8, 0.4, 0.2, 1
            on_release: root.clear_photo()

# Audio Recording Field Component
<AudioRecordingField>:
    
    # Question Input Field
    MDTextField:
        id: question_input
        hint_text: "Enter your audio question here..."
        text: root.question_text
        mode: "outlined"
        size_hint_y: None
        height: dp(56)
        on_text: root.question_text = self.text
    
    # Audio Actions
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(8)
        size_hint_y: None
        height: dp(36)
        
        ModernActionButton:
            button_text: "Record"
            button_icon: "microphone"
            button_color: 0.8, 0.2, 0.2, 1
            on_release: root.start_recording()

# Barcode Field Component
<BarcodeField>:
    
    # Question Input Field
    MDTextField:
        id: question_input
        hint_text: "Enter your barcode/QR question here..."
        text: root.question_text
        mode: "outlined"
        size_hint_y: None
        height: dp(56)
        on_text: root.question_text = self.text
    
    # Barcode Actions
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: dp(8)
        size_hint_y: None
        height: dp(36)
        
        ModernActionButton:
            button_text: "Scan Code"
            button_icon: "qrcode-scan"
            button_color: 0.2, 0.8, 0.2, 1
            on_release: root.scan_barcode()

# Option Input Component for Choice Fields
<OptionInput@MDBoxLayout>:
    option_text: ""
    option_index: 0
    
    orientation: 'horizontal'
    spacing: dp(8)
    size_hint_y: None
    height: dp(40)
    
    MDTextField:
        id: option_field
        hint_text: f"Option {root.option_index + 1}"
        text: root.option_text
        mode: "outlined"
        size_hint_x: 1
        height: dp(40)
        on_text: root.option_text = self.text
    
    MDIconButton:
        icon: "close"
        size_hint: None, None
        size: dp(32), dp(32)
        theme_icon_color: "Custom"
        icon_color: 0.8, 0.2, 0.2, 1
        on_release: root.parent.parent.remove_option_widget(root) 